  const icon = 
  "data:image/png;base64,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";
  
  const cover = 
  "https://extensions.turbowarp.org/images/Skyhigh173/bigint.svg";

  /**
   * @param {unknown} x
   * @returns {bigint}
   */
  const bi = (x) => {
    if (typeof x === "string") {
      // Try to parse things like '8n'
      if (x.charAt(x.length - 1) === "n") {
        try {
          return BigInt(x.slice(0, -1));
        } catch (e) {
          // ignore
        }
      }
      // Must remove decimal using string operations. Math.trunc will convert to float
      // which ruins the point of using bigints.
      const decimalIndex = x.indexOf(".");
      const withoutDecimal =
        decimalIndex === -1 ? x : x.substring(0, decimalIndex);
      try {
        return BigInt(withoutDecimal);
      } catch (e) {
        return 0n;
      }
    }
    try {
      // Here we can use Math.trunc because it's a boolean or number.
      // @ts-expect-error
      return BigInt(Math.trunc(x));
    } catch (e) {
      return 0n;
    }
  };

  class BigIntExtension {
    constructor(runtime) {
      this.runtime = runtime
      this._formatMessage = runtime.getFormatMessage({
        'zh-cn': {
          'BigInt.extensionName': "大数字",
          'BigInt.from': '到大数字 [text]',
          'BigInt.to': '到[text]',
          'BigInt.add': '[a] + [b]',
          'BigInt.sub': '[a] - [b]',
          'BigInt.mul': '[a] * [b]',
          'BigInt.div': '[a] / [b]',
          'BigInt.pow': '[a] ** [b]',
          'BigInt.mod': '[a] mod [b]',
          'BigInt.sel': '[a] [sel] [b]',
          'BigInt.lt': '[a] < [b]',
          'BigInt.le': '[a] ≤ [b]',
          'BigInt.eq': '[a] = [b]',
          'BigInt.neq': '[a] ≠ [b]',
          'BigInt.ge': '[a] ≥ [b]',
          'BigInt.gt': '[a] > [b]',
          'BigInt.and': '[a] & [b]',
          'BigInt.or': '[a] | [b]',
          'BigInt.xor': '[a] ^ [b]',
          'BigInt.ls': '[a] << [b]',
          'BigInt.rs': '[a] >> [b]',
          'BigInt.not': '~ [a]',
        },
    
        en: {
          'BigInt.extensionName': "Big Int",
          'BigInt.from': 'To BigInt [text]',
          'BigInt.to': 'To Number [text]',
          'BigInt.add': '[a] + [b]',
          'BigInt.sub': '[a] - [b]',
          'BigInt.mul': '[a] * [b]',
          'BigInt.div': '[a] / [b]',
          'BigInt.pow': '[a] ** [b]',
          'BigInt.mod': '[a] mod [b]',
          'BigInt.sel': '[a] [sel] [b]',
          'BigInt.lt': '[a] < [b]',
          'BigInt.le': '[a] ≤ [b]',
          'BigInt.eq': '[a] = [b]',
          'BigInt.neq': '[a] ≠ [b]',
          'BigInt.ge': '[a] ≥ [b]',
          'BigInt.gt': '[a] > [b]',
          'BigInt.and': '[a] & [b]',
          'BigInt.or': '[a] | [b]',
          'BigInt.xor': '[a] ^ [b]',
          'BigInt.ls': '[a] << [b]',
          'BigInt.rs': '[a] >> [b]',
          'BigInt.not': '~ [a]',
        },
      })
    }
    
    formatMessage(id) {
      return this._formatMessage({
        id,
        default: id,
        description: id,
      })
    }
    getInfo() {
      return {
        id: "skyhigh173BigInt",
        name: "BigInt",
        color1: "#59C093",
        color2: "#59C093",
        color3: "#59C093",
        blockIconURI: icon,
        blocks: [
          "---" + "✨ Made by SkyHigh173 from Turbowarp",
          {
            opcode: "from",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.from'),
            arguments: {
              text: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "to",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.to'),
            arguments: {
              text: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          "---" + "Arithmetic",
          {
            opcode: "add",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.add'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "sub",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.sub'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "mul",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.mul'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "div",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.div'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "pow",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.pow'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "mod",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.mod'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "select",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.sel'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              sel: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "+",
                menu: "op",
              },
            },
          },
          "---" + "Logic",
          {
            opcode: "lt",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.lt'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "le",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.le'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "eq",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.eq'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "neq",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.neq'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "ge",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.ge'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "gt",
            blockType: Scratch.BlockType.BOOLEAN,
            text: this.formatMessage('BigInt.gt'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          "---" + "Bitwise",
          {
            opcode: "and",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.and'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "or",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.or'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "xor",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.xor'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "ls",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.ls'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "rs",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.rs'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
              b: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
          {
            opcode: "not",
            blockType: Scratch.BlockType.REPORTER,
            text: this.formatMessage('BigInt.not'),
            arguments: {
              a: {
                type: Scratch.ArgumentType.STRING,
                defaultValue: "",
              },
            },
          },
        ],
        menus: {
          op: {
            items: ["+", "-", "*", "/", "%", "^"],
            acceptReporters: true,
          },
        },
      };
    }
    from({ text }) {
      return bi(text);
    }
    to({ text }) {
      return Number(bi(text));
    }
    add({ a, b }) {
      return (bi(a) + bi(b)).toString();
    }
    sub({ a, b }) {
      return (bi(a) - bi(b)).toString();
    }
    mul({ a, b }) {
      return (bi(a) * bi(b)).toString();
    }
    div({ a, b }) {
      if (Number(b) == 0) return "NaN";
      return (bi(a) / bi(b)).toString();
    }
    pow({ a, b }) {
      return (bi(a) ** bi(b)).toString();
    }
    mod({ a, b }) {
      if (Number(b) == 0) return "NaN";
      return (bi(a) % bi(b)).toString();
    }

    and({ a, b }) {
      return (bi(a) & bi(b)).toString();
    }
    or({ a, b }) {
      return (bi(a) | bi(b)).toString();
    }
    xor({ a, b }) {
      return (bi(a) ^ bi(b)).toString();
    }
    ls({ a, b }) {
      return (bi(a) << bi(b)).toString();
    }
    rs({ a, b }) {
      return (bi(a) >> bi(b)).toString();
    }
    not({ a }) {
      return (~bi(a)).toString();
    }

    select({ a, sel, b }) {
      switch (sel) {
        case "+":
          return (bi(a) + bi(b)).toString();
        case "-":
          return (bi(a) - bi(b)).toString();
        case "*":
          return (bi(a) * bi(b)).toString();
        case "/": {
          if (Number(b) == 0) return "NaN";
          return (bi(a) / bi(b)).toString();
        }
        case "%": {
          if (Number(b) == 0) return "NaN";
          return (bi(a) % bi(b)).toString();
        }
        case "^":
        case "**":
          return (bi(a) ** bi(b)).toString();
        default:
          return "0";
      }
    }

    lt({ a, b }) {
      return bi(a) < bi(b);
    }
    gt({ a, b }) {
      return bi(a) > bi(b);
    }
    eq({ a, b }) {
      return bi(a) === bi(b);
    }
    neq({ a, b }) {
      return bi(a) != bi(b);
    }
    le({ a, b }) {
      return bi(a) <= bi(b);
    }
    ge({ a, b }) {
      return bi(a) >= bi(b);
    }
  }

  window.tempExt = {
    Extension: BigIntExtension,
    info: {
      name: 'BigInt.extensionName',
      description: 'BigInt.description',
      extensionId: 'skyhigh173BigInt',
      iconURL: cover,
      insetIconURL: icon,
      featured: true,
      disabled: false,
      collaborator: 'skyhigh173@TW',
      collaboratorURL: 'https://github.com/Skyhigh173',
      collaboratorList: [
            {
                collaborator: 'skyhigh173@TW',
                collaboratorURL: 'https://github.com/Skyhigh173'
            },
            {
                collaborator: 'Fath11@Cocrea',
                collaboratorURL: 'https://cocrea.world/@Fath11'
            },
        ]
    },
    l10n: {
      'zh-cn': {
        'BigInt.extensionName': "大数字",
        'BigInt.description': '无限大的整数(无小数)',
      },
      'en': {
        'BigInt.extensionName': "BigInt",
        'BigInt.description': 'Math blocks that work on infinitely large integers (no decimals).',
      },
    },
  };
