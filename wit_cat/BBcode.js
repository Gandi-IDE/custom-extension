const witcat_BBcode_icon = "data:@file/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKcAAACWCAMAAACM7mjWAAAAjVBMVEUAAADi4eTi4uTh4OPf3+Pq1eri4eXi4eTj4uTi4eXi4uXh4ePf3+Xi4uTi4eXi4eTj4OTf39+/v7/j4uTj4uXi4eTj4uXj4eTj4OTj4uTf3+Df39/h4eTh4OTg3+Th4OPj4uTh3+Ti4uXh4ePi4eLj4uXj3+Pm5ubi4OTi4uXj4ePf39/f39/j4eXi4eQ4kjUHAAAALnRSTlMAn7+AQAzg+sfDuXQo8eekRwgEls2q69hoYxgQbGMwJINwUjosjUAUv7NcMCCHUysqWQAAA2hJREFUeNrt3dly2jAAheEDxvuCF0gwawJkb8/7P17btNO0km1IR7bkjr4XyD8wCC6iY7Ry87gKPc/nEHzPC6s4d/FJByfwOTw/dA64WrENqE+wLXCNTZxRryze4KL6hvrd1Oj2FtAMQYIOK5+m8Fdo485pkrnbkhnSLGFj6PqWprldQ7IxL/N7qGv8m97y1pv1EfowFw4kmmqFP7yZc26K/Dd8MOVbqEmA33ZscxNEkyFEwQ3b7PDLJmWjqD5gOIc6anmtNvjJYZPlGUM7L9nEwbui6SX3HqHDo0dZVuCHLWUvLvRwI8q2+GFBybKELuWSkgW+Syh5KaFPGVGSALijyHOhk+tRdNd4xj9Cr8ems971KVhCtyUFvoucojN021OUI6ZgCv1CCmJMKLiHfvcUVHJ6Av0SCkKIh0AKE6TiUSl1LmCChdTpG/gxAqbiwQRe1ekeHyYKVKv1v3Xyqs7SSamIP1n31rmZUqHs1FNnOaVS2Zd+OmMqNu2ls0ip2qmPzpzKPfTR6VC5sI/Oisp5fXTeUblFH501lVv20fnkU7XXPjoxoWJe0Uvnl4xq5T19v59SqhT39nspWVCZ7AhlnbLjXMk/DHjRvYv+OrvNKHDQxXbaTttpO22n7bSdttN22k7baTttp+20nbbTdtpO22k7bafttJ2203baTttpO22n7bSdttOQzqKOvIZZhvnRrM7cY4tFYlDnzmer9GRM58lnh2xtSGe5YKeJIZ05u/lPZnRWvODVjM6IFzhDdO4/+1dl1RCda/nisuDFiNcT3qULdg4vyAfpfOBfbiFK2C0rB+lcp/zTEZI5O91jkE68CssPkrXHDlHZe6e8i7Ms0CC57ch0MVQnTgHfZSs0e6p8NkrjEv11yvZxNbnLC7R6qh8mkq9H97rfn6O5xzeWe5FjuWdq5L3dMwUhqpHcg47ldP0a7pXnFO2hVfM9/dHsHiCgaAa9ZhQFI9rlSCiJTNw5GctuDLaURQbu8BQZZd4MOsw6do3gsMn8jKHt52ziXNjdeh50dyupn9t2t8zZMXsOUrbZjW4XDnuDd/b2I9wtHM0O5Gh2NeGOY6d0NLuvBr71oTuOXeJiDDvPaY0OiSnfTEGCbjsjdsh3/82u+2h28t8dnND85w58PMdhOuBzHKadz3H4Bhhs5K+IK1U6AAAAAElFTkSuQmCC";

const witcat_BBcode_picture = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBmaWxsPSJub25lIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI2NDAiIGhlaWdodD0iMzYwIiB2aWV3Qm94PSIwIDAgNjQwIDM2MCI+PGRlZnM+PGNsaXBQYXRoIGlkPSJtYXN0ZXJfc3ZnMF8xNF8wMDMiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSI2NDAiIGhlaWdodD0iMzYwIiByeD0iMCIvPjwvY2xpcFBhdGg+PGxpbmVhckdyYWRpZW50IHgxPSIwIiB5MT0iMCIgeDI9IjEiIHkyPSIxIiBpZD0ibWFzdGVyX3N2ZzFfMjFfNTciPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNFMTZDOTYiIHN0b3Atb3BhY2l0eT0iMSIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI0ZCRTRGRCIgc3RvcC1vcGFjaXR5PSIxIi8+PC9saW5lYXJHcmFkaWVudD48ZmlsdGVyIGlkPSJtYXN0ZXJfc3ZnMl8xNF8wMDQiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIiB4PSItNjQiIHk9Ii02MCIgd2lkdGg9IjM5OCIgaGVpZ2h0PSIzOTgiPjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+PGZlQ29sb3JNYXRyaXggaW49IlNvdXJjZUFscGhhIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiLz48ZmVPZmZzZXQgZHk9IjQiIGR4PSIwIi8+PGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMTYiLz48ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4zMDE5NjA3OTYxMTc3ODI2IDAiLz48ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvdyIvPjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93IiByZXN1bHQ9InNoYXBlIi8+PC9maWx0ZXI+PGZpbHRlciBpZD0ibWFzdGVyX3N2ZzNfMTdfMDYzMSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiIHg9Ii0yMCIgeT0iLTE2IiB3aWR0aD0iNDY1IiBoZWlnaHQ9IjQ2MCI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIvPjxmZU9mZnNldCBkeT0iNCIgZHg9IjAiLz48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI1Ii8+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMzAxOTYwNzk2MTE3NzgyNiAwIi8+PGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgcmVzdWx0PSJlZmZlY3QxX2Ryb3BTaGFkb3ciLz48ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvdyIgcmVzdWx0PSJzaGFwZSIvPjwvZmlsdGVyPjwvZGVmcz48ZyBjbGlwLXBhdGg9InVybCgjbWFzdGVyX3N2ZzBfMTRfMDAzKSI+PGc+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjY0MCIgaGVpZ2h0PSIzNjAiIHJ4PSIwIiBmaWxsPSJ1cmwoI21hc3Rlcl9zdmcxXzIxXzU3KSIgZmlsbC1vcGFjaXR5PSIxIi8+PC9nPjxnIGZpbHRlcj0idXJsKCNtYXN0ZXJfc3ZnMl8xNF8wMDQpIj48cGF0aCBkPSJNMjQxLDQ1QzI3MC44MjMsNDUsMjk1LDcxLjg2MjksMjk1LDEwNUwyOTUsMjU1QzI5NSwyODguMTM3LDI3MC44MjMsMzE1LDI0MSwzMTVMNzksMzE1QzQ5LjE3NjYsMzE1LDI0Ljk5OTk5NjkxMDA5LDI4OC4xMzcsMjUsMjU1TDI1LDEwNUMyNC45OTk5OTM4MjAxOSw3MS44NjI5LDQ5LjE3NjYsNDUsNzksNDVMMjQxLDQ1Wk0yNDEsNzVMNzksNzVDNjQuODcwNiw3NC45OTUsNTMuMTI3Miw4Ny4wOTQ3OTk5OTk5OTk5OSw1Mi4wNjc0OTk5OTk5OTk5OTUsMTAyLjc1TDUyLDEwNUw1MiwyNTVDNTEuOTk1NSwyNzAuNjk5LDYyLjg4NTQsMjgzLjc0OCw3Ni45NzUsMjg0LjkyNUw3OSwyODVMMjQxLDI4NUMyNTUuMTI5LDI4NS4wMDUsMjY2Ljg3MywyNzIuOTA1LDI2Ny45MzMsMjU3LjI1TDI2OCwyNTVMMjY4LDEwNUMyNjguMDA0LDg5LjMwMDYsMjU3LjExNSw3Ni4yNTI1LDI0My4wMjUsNzUuMDc1TDI0MSw3NVpNMjI3LjUsMjI1QzIzNC45NTEsMjI1LjAwOCwyNDAuOTg3LDIzMS43MjEsMjQwLjk4NywyNDBDMjQwLjk4NywyNDguMjc5LDIzNC45NTEsMjU0Ljk5MiwyMjcuNSwyNTVMMjAwLjUsMjU1QzE5My4wNDQsMjU1LDE4NywyNDguMjg0LDE4NywyNDBDMTg3LDIzMS43MTYsMTkzLjA0NCwyMjUsMjAwLjUsMjI1TDIyNy41LDIyNVpNMjAwLjUsMTA1QzIwNy45NTIsMTA1LjAwNTY5OTk5OTk5OTk5LDIxMy45OTEsMTExLjcxOTgsMjEzLjk5MSwxMjBDMjEzLjk5MSwxMjguMjgwMTk5OTk5OTk5OTgsMjA3Ljk1MiwxMzQuOTk0MywyMDAuNSwxMzVMMTYwLDEzNUwxNjAsMjQwQzE1OS45OTMsMjQ4LjI3OSwxNTMuOTUxLDI1NC45ODUsMTQ2LjUsMjU0Ljk4NUMxMzkuMDQ5LDI1NC45ODUsMTMzLjAwNywyNDguMjc5LDEzMywyNDBMMTMzLDEzNUw5Mi41LDEzNUM4NS4wNDA1MDAwMDAwMDAwMSwxMzUuMDA1Nyw3OC45OTA3LDEyOC4yODgzLDc4Ljk5MDcsMTIwQzc4Ljk5MDcsMTExLjcxMTcsODUuMDQwNTAwMDAwMDAwMDEsMTA0Ljk5NDMwMDAwMDAwMDAxLDkyLjUsMTA1TDIwMC41LDEwNVoiIGZpbGw9IiNGRkZGRkYiIGZpbGwtb3BhY2l0eT0iMSIvPjwvZz48ZyBmaWx0ZXI9InVybCgjbWFzdGVyX3N2ZzNfMTdfMDYzMSkiPjxwYXRoIGQ9Ik0zNjEuMzQzOCw3OS4yTDM1OS4yNSw5NS45MzQ0TDM1NS4wNzgxLDk4LjY4NDRMMzU4LjUzMTIsMTAxLjUxMjVMMzU2LjQ1MzEsMTE1LjM3MTlRMzU1LjkzNzUsMTE3LjQ2NTYsMzU0LjUsMTE4Ljg0MDZRMzUzLjA2MjUsMTIwLjIsMzUwLjk2ODgsMTIwLjJMMzEyLjIzNDM4LDEyMC4yTDMxNy4wNjI1LDgxLjk1TDMxNC45Njg3NSw3OS4yTDM2MS4zNDM4LDc5LjJaTTMzMC4yMzQ0LDg2LjE2ODdMMzI5LjUxNTYsOTUuMkwzNDUuNDM3NSw5NS4yTDM0Ni43OTY5LDg2LjE2ODdMMzMwLjIzNDQsODYuMTY4N1pNMzI4LjE1NjIsMTAyLjE2ODdMMzI2Ljc4MTIsMTEzLjIzMTJMMzQzLjM0MzgsMTEzLjIzMTJMMzQ0LjcxODgsMTAyLjE2ODdMMzI4LjE1NjIsMTAyLjE2ODdaTTQxNy4zNDQsNzkuMkw0MTUuMjUsOTUuOTM0NEw0MTEuMDc4LDk4LjY4NDRMNDE0LjUzMSwxMDEuNTEyNUw0MTIuNDUzLDExNS4zNzE5UTQxMS45MzgsMTE3LjQ2NTYsNDEwLjUsMTE4Ljg0MDZRNDA5LjA2MiwxMjAuMiw0MDYuOTY4OCwxMjAuMkwzNjguMjM0NCwxMjAuMkwzNzMuMDYyNSw4MS45NUwzNzAuOTY4OCw3OS4yTDQxNy4zNDQsNzkuMlpNMzg2LjIzNDQsODYuMTY4N0wzODUuNTE1Niw5NS4yTDQwMS40Mzc1LDk1LjJMNDAyLjc5NjksODYuMTY4N0wzODYuMjM0NCw4Ni4xNjg3Wk0zODQuMTU2MiwxMDIuMTY4N0wzODIuNzgxMiwxMTMuMjMxMkwzOTkuMzQzOCwxMTMuMjMxMkw0MDAuNzE4OCwxMDIuMTY4N0wzODQuMTU2MiwxMDIuMTY4N1pNNDM3LjI2NTk5OTk5OTk5OTk2LDE5MC4xNjlMNDE1LjE1NiwxOTAuMTY5TDQxMi40MjIsMjA3LjIzMUw0MzEuNzE5LDIwNy4yMzFMNDM1LjE3MiwyMDQuNDE5TDQzMy44MTIsMjE0LjJMMzk3Ljg3NSwyMTQuMkw0MDIuNzAzMSwxODMuMkw0MzcuOTg0MDAwMDAwMDAwMDQsMTgzLjJMNDM3LjI2NTk5OTk5OTk5OTk2LDE5MC4xNjlaTTQ3OC4zNTkwMDAwMDAwMDAwNCwxODMuMlE0ODAuNDM4LDE4My4yLDQ4MS40NjksMTg0LjkwM1E0ODIuNSwxODYuNjA2LDQ4Mi41LDE4OC43MTZMNDc5LjA2MiwyMTQuMkw0NDguMTU2LDIxNC4yUTQ0Ni4wNzgsMjE0LjIsNDQ1LjAzMSwyMTIuODI1UTQ0NCwyMTEuNDUsNDQ0LDIwOS4zNDFMNDQ3LjQzOCwxODMuMkw0NzguMzU5MDAwMDAwMDAwMDQsMTgzLjJaTTQ2MC40NTMsMTkwLjE2OUw0NTcuNzM0MDAwMDAwMDAwMDQsMjA3LjIzMUw0NjUuOTY5LDIwNy4yMzFMNDY4Ljc2NTk5OTk5OTk5OTk2LDE5MC4xNjlMNDYwLjQ1MywxOTAuMTY5Wk01MTUuNjU2LDE2OC4yTDUyOS40ODQsMTY4LjJMNTIzLjI4MSwyMTQuMkw0OTIuMTg4LDIxNC4yUTQ5MC4wOTQsMjE0LjIsNDg5LjA0NywyMTIuODI1UTQ4OCwyMTEuNDUsNDg4LDIwOS4zNDFMNDkxLjQ2OSwxODMuMkw1MTMuNTYyLDE4My4yTDUxNS42NTYsMTY4LjJaTTUwNC4yMDMsMTkwLjE2OUw1MDEuNTQ3LDIwNy4yMzFMNTEwLjMyOCwyMDcuMjMxTDUxMi45MjIsMTkwLjE2OUw1MDQuMjAzLDE5MC4xNjlaTTU3MS42NTYsMjAxLjJMNTQ5LjU0NywyMDEuMkw1NDguODI4LDIwNy4yMzFMNTY4LjIwMywyMDcuMjMxTDU3MS42NTYsMjA0LjI2Mkw1NjkuNTYyLDIxNC4yTDUzOS4xODgsMjE0LjJRNTM3LjA5NCwyMTQuMiw1MzYuMDQ3LDIxMi44MjVRNTM1LDIxMS40NSw1MzUsMjA5LjM0MUw1MzguNDY5LDE4My4yTDU3NC4zOTEwMDAwMDAwMDAxLDE4My4yTDU3MS42NTYsMjAxLjJaTTU1MS41NjIsMTkwLjE2OUw1NTAuOTIyLDE5NC4yMzFMNTU5LjIwMywxOTQuMjMxTDU1OS45MjIsMTkwLjE2OUw1NTEuNTYyLDE5MC4xNjlaIiBmaWxsPSIjRkZGRkZGIiBmaWxsLW9wYWNpdHk9IjEiLz48L2c+PC9nPjwvc3ZnPg==";

const witcat_BBcode_extensionId = "WitCatBBcode";

let bbcode, bbcodemousedown = {};

/**
 * è·å–åˆ°çš„è¿”å›å€¼
 */

/** @typedef {string|number|boolean} SCarg æ¥è‡ªScratchåœ†å½¢æ¡†çš„å‚æ•°ï¼Œè™½ç„¶è¿™ä¸ªæ¡†å¯èƒ½åªèƒ½è¾“å…¥æ•°å­—ï¼Œä½†æ˜¯å¯ä»¥æ”¾å…¥å˜é‡ï¼Œå› æ­¤æœ‰å¯èƒ½è·å¾—æ•°å­—ã€å¸ƒå°”å’Œæ–‡æœ¬ï¼ˆæç«¯æƒ…å†µä¸‹è¿˜æœ‰ null æˆ– undefinedï¼Œéœ€è¦åŒæ—¶å¤„ç† */

class WitCatBBcode {
    constructor(runtime) {
        this.runtime = runtime;

        this.resize = null;

        /**
         * Scratch æ‰€ä½¿ç”¨çš„ canvasï¼Œè·å–ä¸åˆ°è¿”å› null
         * @return {HTMLcanvasElement | null}
         */
        this.canvas = () => {
            try {
                const canvas = runtime.renderer.canvas;
                if (canvas instanceof HTMLCanvasElement) {
                    return canvas;
                }
            } catch (err) {
                return null;
            }
        };

        /**
         * æ‰€æœ‰è¾“å…¥æ¡†æ‰€åœ¨çš„çˆ¶è§’è‰²ï¼Œç›®å‰è®¾ä¸º canvas çš„çˆ¶è§’è‰²ã€‚
         * è·å–ä¸åˆ°è¿”å› null
         * @return {HTMLElement | null}
         */
        this.inputParent = () => {
            try {
                const canvas = runtime.renderer.canvas;
                if (canvas instanceof HTMLCanvasElement) {
                    return canvas.parentElement;
                }
            } catch (err) {
                console.error(err);
                return null;
            }
        };


        /**
         * åˆ›å»ºæ»šåŠ¨æ¡
         */
        document.documentElement.style.setProperty('--witcat-bbcode-scale', '1');
        let ScrollStyle = document.createElement("style");
        ScrollStyle.innerText = `
        h1{
            font-size:2.0em;
        }
        h3{
            font-size:1.17em;
        }
        h5{
            font-size:0.83em;
        }
        h6{
            font-size:0.67em;
        }
        .WitCatBBcode::-webkit-scrollbar{
            display: none;
        }
        .WitCatBBcode{
            color:black;
        }
        .WitCatBBcodes{
            transform-origin: 0 0;
            zoom:var(--witcat-bbcode-scale);
        }
        .WitCatBBcode ul{
            padding-inline-start: 40px;
            list-style:none;
        }
        .WitCatBBcode ol{
            padding-inline-start: 40px;
            list-style:auto;
        }
        .WitCatBBcode blockquote{
            display: block;
            margin-block-start: 1em;
            margin-block-end: 1em;
            margin-inline-start: 40px;
            margin-inline-end: 40px;
        }
        code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:0px;margin:0px;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}
        `;
        document.body.appendChild(ScrollStyle);

        this._formatMessage = runtime.getFormatMessage({
            "zh-cn": {
                "WitCatBBcode.name": "[beta]ç™½çŒ«çš„BBcode",
                "WitCatBBcode.docs": "ğŸ“–æ‹“å±•æ•™ç¨‹",
                "WitCatBBcode.docss": "ğŸ“–ç¤ºä¾‹å†…å®¹",
                "WitCatBBcode.tutorial": '[size=40]æ¬¢è¿æ¥åˆ°[color=#ffff00]ç™½çŒ«[/color]çš„BBcode[/size]\n\nåŠ ç²—ï¼š\n[b]ç²—ä½“å­— Bold text[/b]\n\næ–œä½“ï¼š\n[i]æ–œä½“å­— Italic[/i]\n\nåˆ é™¤çº¿ï¼š\n[s]åˆ é™¤çº¿[/s]\n\nä¸‹åˆ’çº¿ï¼š\n[u]ä¸‹åˆ’çº¿[/u]\n\næ”¹å˜å­—å·ï¼š\n[size=2]å¤§å°å¯å˜[/size]\n\næ”¹å˜é¢œè‰²ï¼š\n[color=#ff0000]æˆ‘æ˜¯çº¢è‰²[/color]\n\nç½‘é¡µé“¾æ¥ï¼š\n[url=https://ccw.site/]ç¤ºä¾‹ç½‘å€[/url]\n\nå¼•ç”¨ï¼š\n[quote]ã€Šæˆ‘ä¸‰ã€‹æ˜¯ã€Šè‰ºä¸‰ã€‹éš¾ä»¥ä¼åŠçš„æ ‡æ†[/quote]\n\nåˆ—è¡¨ï¼ˆæ— åºï¼‰ï¼š\n[list]\n[*]åˆ—è¡¨é¡¹ç›®\n[*]åˆ—è¡¨é¡¹ç›®\n[/list]\n\nåˆ—è¡¨ï¼ˆæ•°å­—ï¼‰ï¼š\n[list=1]\n[*]åˆ—è¡¨é¡¹ç›®A\n[*]åˆ—è¡¨é¡¹ç›®B\n[/list]\n\nåˆ—è¡¨ï¼ˆå­—æ¯ï¼‰ï¼š\n[list=a]\n[*]åˆ—è¡¨é¡¹ç›®A\n[*]åˆ—è¡¨é¡¹ç›®B\n[/list]\n\næ’å…¥å›¾ç‰‡ï¼š\n[img=5]https://m.xiguacity.cn/works-covers/f6348af6-ba33-4172-b99d-246733242a00.png?x-oss-process=image%2Fresize%2Cs_360%2Fformat%2Cwebp[/img]\n\næ’å…¥ä»£ç ï¼š\n[code]printf("hello world!")[/code]\nä½¿ç”¨ä»£ç é«˜äº®ç§¯æœ¨ä¸ºä»£ç é…ç½®è¯­è¨€é«˜äº®\n\nå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åµŒå¥—ï¼š\n[color=#ff0000][b][size=100]aaa[/size][/b][/color]',
                "WitCatBBcode.create": "åˆ›å»º BBcode ID[id]X[x]Y[y]å®½[width]é«˜[height]å†…å®¹[text]",
                "WitCatBBcode.delete": "åˆ é™¤ BBcode ID[id]",
                "WitCatBBcode.deleteall": "åˆ é™¤æ‰€æœ‰ BBcode ",
                "WitCatBBcode.get": " BBcode ID[id]çš„[type]",
                "WitCatBBcode.set": "è®¾ç½® BBcode ID[id]çš„[type]ä¸º[text]",
                "WitCatBBcode.imgstyle": " BBcode ID[id]çš„ç¬¬[num]å¼ å›¾ç‰‡çš„å®½[width]é«˜[height]",
                "WitCatBBcode.loadfontfamily": "ä»[text]åŠ è½½å­—ä½“å[name]",
                "WitCatBBcode.setfontfamily": "è®¾ç½® BBcode ID[id]çš„å­—ä½“ä¸º[name]",
                "WitCatBBcode.code": "è®¾ç½® BBcode ID[id]ç¬¬[num]ä¸ªä»£ç æ¡†çš„é«˜äº®ä¸º[name]",
                "WitCatBBcode.ide": "è®¾ç½® BBcode ID[id]ä¸º[name]",
                "WitCatBBcode.size": "BBcodeå¤§å°è‡ªé€‚åº”[type]",
                "WitCatBBcode.type.1": "X",
                "WitCatBBcode.type.2": "Y",
                "WitCatBBcode.type.3": "å®½",
                "WitCatBBcode.type.4": "é«˜",
                "WitCatBBcode.type.5": "å†…å®¹",
                "WitCatBBcode.type.6": "json",
                "WitCatBBcode.ide.1": "å¯ç¼–è¾‘",
                "WitCatBBcode.ide.2": "ä¸å¯ç¼–è¾‘",
                "WitCatBBcode.types.1": "å¯åŠ¨",
                "WitCatBBcode.types.2": "å…³é—­",
                "WitCatBBcode.getwidth": "è·å–å†…å®¹[content]çš„æ¸²æŸ“[type]",
                "WitCatBBcode.click": "ä¸Šæ¬¡ç‚¹å‡»çš„å…ƒç´ çš„[clickmenu]",
                "WitCatBBcode.clickmenu.1": "bbcodeæ¥æº",
                "WitCatBBcode.clickmenu.2": "ç±»å‹",
                "WitCatBBcode.clickmenu.3": "åºå·",
            },
            en: {
                "WitCatBBcode.name": "[beta]WitCatâ€™s BBcode",
                "WitCatBBcode.docs": "ğŸ“– Tutorial",
                "WitCatBBcode.docss": "ğŸ“–Example Content",
                "WitCatBBcode.tutorial": '[size=40] Welcome to [color=#ffff00] White Cat [/color] BBcode[/size]\n\nBold:\n[/b] Bold text[/b]\n\nItalics:\n[i] Italic[/i]\n\nDelete line:\n[s] stripper line [/s]\n\nUnderline:\n[u] Underline [/u]\n\nChange the font size:\n[size=2] Variable size [/size]\n\nChange color:\n[color=#ff0000] I am red [/color]\n\nWeb link:\n[url=https://ccw.site/] Example url [/url]\n\nQuote:\n[quote] "My Three" is "Art Three" difficult to match the benchmark [/quote]\n\nList (unordered) :\n[list]\n[*] List items\n[*] List items\n[/list]\n\nList (numbers) :\n[list=1]\n[*] List item A\n[*] List item B\n[/list]\n\nList (letters) :\n[list=a]\n[*] List item A\n[*] List item B\n[/list]\n\nInsert picture:\n[img=5]https://m.xiguacity.cn/works-covers/f6348af6-ba33-4172-b99d-246733242a00.png?x-oss-process=image%2Fresize%2Cs_360 %2Fformat%2Cwebp[/img]\n\nInsert code:\n[code]printf("hello world!" )[/code]\nConfigure language highlighting for code using code highlighting blocks\n\nOf course, you can also nest:\n[color=#ff0000][b][size=100]aaa[/size][/b][/color]',
                "WitCatBBcode.create": "Create BBcode ID[id]X[x]Y[y] width [width] height [height] content [text]",
                "WitCatBBcode.delete": "Delete BBcode ID[id]",
                "WitCatBBcode.deleteall": "Delete all BBcode",
                "WitCatBBcode.get": "ID[id]BBcode`s[type]",
                "WitCatBBcode.set": "set BBcode ID[id]`s[type] to [text]",
                "WitCatBBcode.imgstyle": "BBcode ID[id] width of [num] picture [width] height [height]",
                "WitCatBBcode.loadfontfamily": "load[name]from url[text]",
                "WitCatBBcode.setfontfamily": "set BBcode ID[id]`s font family[name]",
                "WitCatBBcode.code": "Set the [num] code box highlighted by BBcode ID[id] to [name]",
                "WitCatBBcode.ide": "Set BBcode ID[id] to [name]",
                "WitCatBBcode.size": "BBcode size adaptive[type]",
                "WitCatBBcode.type.1": "X",
                "WitCatBBcode.type.2": "Y",
                "WitCatBBcode.type.3": "width",
                "WitCatBBcode.type.4": "height",
                "WitCatBBcode.type.5": "content",
                "WitCatBBcode.type.6": "json",
                "WitCatBBcode.ide.1": "editable",
                "WitCatBBcode.ide.2": "uneditable",
                "WitCatBBcode.types.1": "turn on",
                "WitCatBBcode.types.2": "turn off",
                "WitCatBBcode.getwidth": "get[content]`s render[type]",
                "WitCatBBcode.click": "Last clicked element`s[clickmenu]",
                "WitCatBBcode.clickmenu.1": "bbcode Source",
                "WitCatBBcode.clickmenu.2": "type",
                "WitCatBBcode.clickmenu.3": "Serial number",
            }
        })
    }

    /**
     * ç¿»è¯‘
     * @param {string} id
     * @return {string}
     */
    formatMessage(id) {
        return this._formatMessage({
            id,
            default: id,
            description: id
        });
    }

    getInfo() {
        return {
            id: witcat_BBcode_extensionId, // æ‹“å±•id
            name: this.formatMessage("WitCatBBcode.name"), // æ‹“å±•å
            blockIconURI: witcat_BBcode_icon,
            menuIconURI: witcat_BBcode_icon,
            color1: "#e16c96",
            color2: "#c75f85",
            blocks: [
                {
                    blockType: "button",
                    text: this.formatMessage('WitCatBBcode.docs'),
                    onClick: this.docs,
                },
                "---" + this.formatMessage("WitCatBBcode.name"),
                {
                    opcode: "create",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.create"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: 'i',
                        },
                        x: {
                            type: "number",
                            defaultValue: '0',
                        },
                        y: {
                            type: "number",
                            defaultValue: '0',
                        },
                        width: {
                            type: "number",
                            defaultValue: '100',
                        },
                        height: {
                            type: "number",
                            defaultValue: '100',
                        },
                        text: {
                            type: "string",
                            defaultValue: 'wit_cat!!!',
                        },
                    },
                },
                {
                    opcode: "set",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.set"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: 'i',
                        },
                        type: {
                            type: "string",
                            menu: 'types',
                        },
                        text: {
                            type: "string",
                            defaultValue: '0',
                        },
                    },
                },
                {
                    opcode: "imgstyle",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.imgstyle"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: 'i',
                        },
                        num: {
                            type: "number",
                            defaultValue: '1',
                        },
                        width: {
                            type: "string",
                            defaultValue: '100',
                        },
                        height: {
                            type: "string",
                            defaultValue: '100',
                        },
                    },
                },
                {
                    opcode: "code",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.code"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: "i",
                        },
                        num: {
                            type: "number",
                            defaultValue: "1",
                        },
                        name: {
                            type: "string",
                            menu: "code",
                        },
                    },
                },
                {
                    opcode: "ide",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.ide"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: "i",
                        },
                        num: {
                            type: "number",
                            defaultValue: "1",
                        },
                        name: {
                            type: "string",
                            menu: "ide",
                        },
                    },
                },
                {
                    opcode: "size",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.size"),
                    arguments: {
                        type: {
                            type: "boolean",
                            menu: "typess",
                        },
                    },
                },
                {
                    opcode: "setfont",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.setfontfamily"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: "i",
                        },
                        name: {
                            type: "string",
                            defaultValue: "arial",
                        },
                    },
                },
                {
                    opcode: "loadfont",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.loadfontfamily"),
                    arguments: {
                        text: {
                            type: "string",
                            defaultValue: "url",
                        },
                        name: {
                            type: "string",
                            defaultValue: "arial",
                        },
                    },
                },
                {
                    opcode: "delete",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.delete"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: 'i',
                        },
                    },
                },
                {
                    opcode: "deleteall",
                    blockType: "command",
                    text: this.formatMessage("WitCatBBcode.deleteall"),
                    arguments: {},
                },
                {
                    opcode: "get",
                    blockType: "reporter",
                    text: this.formatMessage("WitCatBBcode.get"),
                    arguments: {
                        id: {
                            type: "string",
                            defaultValue: 'i',
                        },
                        type: {
                            type: "string",
                            menu: 'type',
                        },
                    },
                },
                {
                    opcode: "getwidth",
                    blockType: "reporter",
                    text: this.formatMessage("WitCatBBcode.getwidth"),
                    arguments: {
                        content: {
                            type: "string",
                            defaultValue: 'witcat',
                        },
                        type: {
                            type: "string",
                            menu: 'width',
                        },
                    },
                },
                {
                    opcode: "click",
                    blockType: "reporter",
                    text: this.formatMessage("WitCatBBcode.click"),
                    arguments: {
                        clickmenu: {
                            type: "string",
                            menu: 'clickmenu',
                        },
                    },
                },
                {
                    opcode: "docss",
                    blockType: "reporter",
                    text: this.formatMessage("WitCatBBcode.docss"),
                    disableMonitor: true,
                    arguments: {},
                },
            ],
            menus: {
                type: [
                    {
                        text: this.formatMessage('WitCatBBcode.type.1'),
                        value: 'x'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.2'),
                        value: 'y'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.3'),
                        value: 'width'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.4'),
                        value: 'height'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.5'),
                        value: 'content'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.6'),
                        value: 'json'
                    },
                ],
                types: [
                    {
                        text: this.formatMessage('WitCatBBcode.type.1'),
                        value: 'x'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.2'),
                        value: 'y'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.3'),
                        value: 'width'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.4'),
                        value: 'height'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.5'),
                        value: 'content'
                    },
                ],
                typess: [
                    {
                        text: this.formatMessage('WitCatBBcode.types.1'),
                        value: 'true'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.types.2'),
                        value: 'false'
                    }
                ],
                code: [
                    {
                        text: "javascript",
                        value: 'language-javascript'
                    },
                    {
                        text: "css",
                        value: 'language-css'
                    },
                    {
                        text: "HTML",
                        value: 'language-html'
                    },
                    {
                        text: "python",
                        value: 'language-python'
                    },
                ],
                ide: [
                    {
                        text: this.formatMessage('WitCatBBcode.ide.1'),
                        value: 'true'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.ide.2'),
                        value: 'false'
                    },
                ],
                width: [
                    {
                        text: this.formatMessage('WitCatBBcode.type.3'),
                        value: 'width'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.type.4'),
                        value: 'height'
                    },
                ],
                clickmenu: [
                    {
                        text: this.formatMessage('WitCatBBcode.clickmenu.1'),
                        value: 'bbcode'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.clickmenu.2'),
                        value: 'type'
                    },
                    {
                        text: this.formatMessage('WitCatBBcode.clickmenu.3'),
                        value: 'number'
                    },
                ],
            },
        };
    }

    /** æ‰“å¼€æ•™ç¨‹ */
    docs() {
        let a = document.createElement('a');
        a.href = "https://www.ccw.site/post/7d129e01-e30a-4d88-92d2-320b555ed0f5";
        a.rel = "noopener noreferrer";
        a.target = "_blank";
        a.click();
    }
    /**
     * é™åˆ¶å€¼çš„èŒƒå›´ï¼Œå¦‚æœå€¼æ˜¯NaNï¼Œè¿”å›æœ€å°å€¼
     * @param {number} x æ•°å€¼
     * @param {number} min æœ€å°å€¼
     * @param {number} max æœ€å¤§å€¼
     * @return {number}
     */
    _clamp(x, min, max) {
        return isNaN(x) ? min : x < min ? min : x > max ? max : x;
        // return isNaN(x) ? min : Math.min(max, Math.max(min, x));
    }
    /**
     * åˆ›å»ºæ–‡æœ¬æ¡†
     * @param {Object} args 
     */
    create(args) {
        if (this.canvas() === null || this.inputParent() === null) {
            console.error(this.canvas(), this.inputParent())
            return;
        }
        let x = Number(args.x);
        let y = Number(args.y);
        let width = Number(args.width);
        let height = Number(args.height);
        x = this._clamp(x, 0, this.runtime.stageWidth);
        y = this._clamp(y, 0, this.runtime.stageHeight);
        width = this._clamp(width, 0, this.runtime.stageWidth - x);
        height = this._clamp(height, 0, this.runtime.stageHeight - y);
        x = (x / this.runtime.stageWidth) * 100;
        y = (y / this.runtime.stageHeight) * 100;
        width = (width / this.runtime.stageWidth) * 100;
        height = (height / this.runtime.stageHeight) * 100;

        /** @type {HTMLDivElement|null} */
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            this.inputParent().removeChild(search);
            search = null;
        }
        if (search === null) {
            search = document.createElement("div");
            search.id = "WitCatBBcode" + args.id;
            search.className = "WitCatBBcode";
            search.style.overflow = "auto";
            search.style.webkitUserSelect = "text";
            search.style.userSelect = "text";
            this.inputParent().appendChild(search);
        }

        let sstyle = search.style;
        sstyle.position = "absolute";
        sstyle.left = `${x}%`;
        sstyle.top = `${y}%`;
        sstyle.width = `${width}%`;
        sstyle.height = `${height}%`;
        search.innerHTML = `<div class='WitCatBBcodes'>${new bbcode.Parser().toHTML(String(args.text))}</div>`;
    }

    imgstyle(args) {
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            if (search.getElementsByTagName("img").length > args.num - 1 && args.num > 0) {
                search.getElementsByTagName("img")[args.num - 1].style.width = args.width == "" ? "" : args.width + "px";
                search.getElementsByTagName("img")[args.num - 1].style.height = args.height == "" ? "" : args.height + "px";
            }
        }
    }

    /**
     * è®¾ç½®bbcode
     * @param {object} args
     * @param {SCarg} args.id ID
     * @param {SCarg} args.type å±æ€§ç±»å‹
     * @param {SCarg} args.text å±æ€§å€¼
     */
    set(args) {
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            const sstyle = search.style;
            let x;
            let y;
            let width;
            let height;
            switch (args.type) {
                case "x":
                    x = this._clamp(Number(args.text), 0, this.runtime.stageWidth);
                    x = (x / this.runtime.stageWidth) * 100;
                    sstyle.left = `${x}%`;
                    break;
                case "y":
                    y = this._clamp(Number(args.text), 0, this.runtime.stageHeight);
                    y = (y / this.runtime.stageHeight) * 100;
                    sstyle.top = `${y}%`;
                    break;
                case "width":
                    x = (parseFloat(sstyle.left) / 100) * this.runtime.stageWidth;
                    width = this._clamp(Number(args.text), 0, this.runtime.stageWidth - x);
                    width = (width / this.runtime.stageWidth) * 100;
                    sstyle.width = `${Number(width)}%`;
                    break;
                case "height":
                    y = (parseFloat(sstyle.top) / 100) * this.runtime.stageHeight;
                    height = this._clamp(Number(args.text), 0, this.runtime.stageHeight - y);
                    height = (height / this.runtime.stageHeight) * 100;
                    sstyle.height = `${Number(height)}%`;
                    break;
                case "content":
                    search.innerHTML = `<div class='WitCatBBcodes'>${new bbcode.Parser().toHTML(String(args.text))}</div>`;
                    break;
                default:
                    break;
            }
        }
    }

    /**
     * è®¾ç½®å­—ä½“
     * @param {object} args 
     * @param {string} args.id ID
     * @param {string} args.name è¦è®¾ç½®çš„å­—ä½“
     */
    setfont(args) {
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            search.style.fontFamily = `"${args.name}"`;
        }
    }

    /**
     * è®¾ç½®ä»£ç æ¡†é«˜äº®
     * @param {object} args 
     */
    code(args) {
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            if (search.getElementsByTagName("code").length > args.num - 1 && args.num > 0) {
                let a = search.getElementsByTagName("code")[args.num - 1].children;
                a.forEach((e) => {
                    e.className = args.name;
                })
                Prism.highlightAll();
            }
        }
    }

    ide(args) {
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            search.setAttribute("contenteditable", args.name);
            search.style.outline = "none";
        }
    }


    getwidth(args) {
        if (this.canvas() === null || this.inputParent() === null) {
            console.error(this.canvas(), this.inputParent())
            return;
        }
        let search = document.createElement("span");
        search.style.position = "fixed";
        search.className = "WitCatBBcode";
        search.innerHTML = `<div class='WitCatBBcodes'>${new bbcode.Parser().toHTML(String(args.content))}</div>`;
        document.body.appendChild(search);
        let cvsw = this.canvas().offsetWidth;
        let cvsh = this.canvas().offsetHeight;
        let outw, out;
        switch (args.type) {
            case "width":
                outw = search.offsetWidth;
                search.remove();
                out = outw * (this.runtime.stageWidth / (cvsw * 0.748));
                return out;
            case "height":
                outw = search.offsetHeight;
                search.remove();
                out = outw * (this.runtime.stageHeight / (cvsh * 0.777));
                return out;
        }
        return "";
    }

    size(args) {
        if (this.canvas() === null) {
            return;
        }
        if (Boolean(args.type)) {
            if (this.resize === null) {
                this.resize = new ResizeObserver(() => {
                    document.documentElement.style.setProperty('--witcat-bbcode-scale', this.canvas().offsetHeight / 360)
                })
                this.resize.observe(this.canvas(), { attributes: true, attributeFilter: ['style'] });
            }
        }
        else {
            this.resize.disconnect();
            this.resize = null;
        }
    }

    /**
     * åŠ è½½å­—ä½“
     * @param {object} args 
     * @param {string} args.id ID
     * @param {string} args.name è¦è·å–çš„å­—ä½“
     */
    loadfont(args) {
        if (
            String(args.text).startsWith("https://m.ccw.site") ||
            String(args.text).startsWith("https://m.xiguacity") ||
            String(args.text).startsWith("https://static.xiguacity")) {
            const xhr = new XMLHttpRequest(); // å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å¯¹è±¡
            xhr.open("GET", String(args.text), true); // å¼‚æ­¥GETæ–¹å¼åŠ è½½å­—ä½“
            xhr.responseType = "arraybuffer"; // æŠŠå¼‚æ­¥è·å–ç±»å‹æ”¹ä¸ºarraybufferäºŒè¿›åˆ¶ç±»å‹
            xhr.onload = function () {
                document.fonts.add(new FontFace(String(args.name), this.response)); // å°†å­—ä½“å¯¹è±¡æ·»åŠ åˆ°é¡µé¢ä¸­
            };
            xhr.send();
        }
        else {
            console.warn("ä¸å…è®¸çš„é“¾æ¥\nDisallowed links")
        }
    }

    click(args) {
        let out = "";
        if (JSON.stringify(bbcodemousedown) !== "{}") {
            let s = document.getElementsByClassName("WitCatBBcodes");
            s.forEach((e) => {
                if (e.contains(bbcodemousedown.target)) {
                    switch (args.clickmenu) {
                        case "bbcode":
                            out = e.parentElement.id.split("WitCatBBcode")[1];
                            break;
                        case "type":
                            out = bbcodemousedown.target.tagName.toLowerCase();
                            break;
                        case "number":
                            let ss = e.getElementsByTagName(bbcodemousedown.target.tagName.toLowerCase());
                            for (let i = 0; i < ss.length; i++) {
                                if (ss[i] === bbcodemousedown.target) {
                                    out = i + 1;
                                    return;
                                }
                            };
                            break;
                        default:
                            break;
                    }
                }
            })
        }
        return out;
    }

    /**
     * è·å–ä»£ç è¿”å›å€¼
     * @param {Object} args
     */
    get(args) {
        if (this.canvas() === null || this.inputParent() === null) {
            return;
        }
        let search = null;
        let search_1 = document.getElementById("WitCatBBcode" + args.id);
        if (search_1 instanceof HTMLDivElement) {
            search = search_1;
        }
        if (search !== null) {
            return this._getattrib(search, args.type);
        }
    }

    /**
     * åˆ é™¤æ–‡æœ¬æ¡†
     * @param {Object} args 
     * @returns 
     */
    delete(args) {
        if (this.inputParent() === null) {
            return;
        }
        let search = document.getElementById("WitCatBBcode" + args.id);
        if (search !== null) {
            this.inputParent().removeChild(search);
        }
    }

    /**
     * åˆ é™¤æ‰€æœ‰æ–‡æœ¬æ¡†
     * @param {Object} args 
     * @returns 
     */
    deleteall() {
        if (this.inputParent() === null) {
            return;
        }
        let search = document.getElementsByClassName("WitCatBBcode");
        for (const item of Array.from(search)) {
            this.inputParent().removeChild(item);
        }
    }

    /**
     * è·å–ç¤ºä¾‹BBcode
     * @returns {string}
     */
    docss() {
        return this.formatMessage('WitCatBBcode.tutorial');
    }

    /**
     * è·å–æ–‡æœ¬æ¡†çš„å±æ€§
     * @param {Element} element æ–‡æœ¬æ¡†å…ƒç´ 
     * @param {string} type å±æ€§ç±»å‹
     * @returns {number|string}
     */
    _getattrib(element, type) {
        // ç”¨äºé€šè¿‡ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ä¸å‡ºé”™
        if (!(element instanceof HTMLDivElement)) {
            console.warn("Input.js: è·å–åˆ°çš„å…ƒç´ çš„ç±»å‹ä¸æ­£ç¡®: ", element);
            return "";
        }
        switch (type) {
            case "x":
                return parseFloat(element.style.left) / 100 * this.runtime.stageWidth;
            case "y":
                return parseFloat(element.style.top) / 100 * this.runtime.stageHeight;
            case "width":
                return parseFloat(element.style.width) / 100 * this.runtime.stageWidth;
            case "height":
                return parseFloat(element.style.height) / 100 * this.runtime.stageHeight;
            case "content":
                return htmltobbcode(String(element.innerHTML));
            case "json":
                // ç›´æ¥æŠŠæ•´ä¸ªä¸œè¥¿è½¬æˆ JSON å¯¹è±¡ï¼Œå†æ‹¼æ¥
                return JSON.stringify(
                    {
                        X: this._getattrib(element, "x"),
                        Y: this._getattrib(element, "y"),
                        width: this._getattrib(element, "width"),
                        height: this._getattrib(element, "height"),
                        content: this._getattrib(element, "content"),
                    }
                )
            default:
                return "";
        }
    }
}

window.tempExt = {
    Extension: WitCatBBcode,
    info: {
        name: "WitCatBBcode.name",
        description: "WitCatBBcode.descp",
        extensionId: witcat_BBcode_extensionId,
        iconURL: witcat_BBcode_picture,
        insetIconURL: witcat_BBcode_icon,
        featured: true,
        disabled: false,
        collaborator: "ç™½çŒ« @ CCW"
    },
    l10n: {
        "zh-cn": {
            "WitCatBBcode.name": "[beta]ç™½çŒ«çš„BBcode",
            "WitCatBBcode.descp": "æ›´ä¼˜é›…çš„æ–‡æœ¬æ¡†"
        },
        en: {
            "WitCatBBcode.name": "[beta]WitCatâ€™s BBcode",
            "WitCatBBcode.descp": "Make your text box more colorful"
        }
    }
};

function htmltobbcode(htmlInput) {
    // Replace <br> tags with BBCode line breaks (æ¢è¡Œ)
    let bbcodeText = htmlInput.replace(/<br\s*\/?>/gi, '\n');


    // Replace <div> tags with BBCode line breaks (æ¢è¡Œ)
    bbcodeText = bbcodeText.replace(/<div\s*\/?>/gi, '\n');

    // Replace <b> tags with BBCode bold ([b])
    bbcodeText = bbcodeText.replace(/<strong\b[^>]*>(.*?)<\/strong>/gi, '[b]$1[/b]');

    // Replace <i> tags with BBCode italic ([i])
    bbcodeText = bbcodeText.replace(/<em\b[^>]*>(.*?)<\/em>/gi, '[i]$1[/i]');


    // Replace <s> tags with BBCode deleteline ([s])
    bbcodeText = bbcodeText.replace(/<strike\b[^>]*>(.*?)<\/strike>/gi, '[s]$1[/s]');

    // Replace <u> tags with BBCode underline ([u])
    bbcodeText = bbcodeText.replace(/<u\b[^>]*>(.*?)<\/u>/gi, '[u]$1[/u]');

    // Replace <a> tags with BBCode URL ([url])
    bbcodeText = bbcodeText.replace(/<a\s+(?:[^>]*?\s+)?href=(["'])(.*?)\1[^>]*>(.*?)<\/a>/gi, '[url=$2]$3[/url]');

    // Replace <img> tags with BBCode image ([img])
    bbcodeText = bbcodeText.replace(/<img\s+(?:[^>]*?\s+)?src=(["'])(.*?)\1[^>]*>/gi, '[img]$2[/img]');

    // Replace <blockquote> tags with BBCode quote ([quote])
    bbcodeText = bbcodeText.replace(/<blockquote\b[^>]*>(.*?)<\/blockquote>/gi, '[quote]$1[/quote]');

    // Replace <code> tags with BBCode code ([code])
    bbcodeText = bbcodeText.replace(/<code\b[^>]*>(.*?)<\/code>/gi, '[code]$1[/code]');

    // Replace <h1> to <h6> tags with BBCode headers ([h1] to [h6])
    bbcodeText = bbcodeText.replace(/<h([1-6])\b[^>]*>(.*?)<\/h\1>/gi, '[h$1]$2[/h$1]');

    // Replace <ol> and <li> tags with BBCode ordered list ([list=1] and [*])
    bbcodeText = bbcodeText.replace(/<ol\s+style=(["'])list-style-type:lower-alpha;\1[^>]*>([\s\S]*?)<\/ol>/gi, '[list=a]$2[/list]');
    bbcodeText = bbcodeText.replace(/<ol\b[^>]*>([\s\S]*?)<\/ol>/gi, '[list=1]$1[/list]');

    // Replace <ul> and <li> tags with BBCode list ([list] and [*])
    bbcodeText = bbcodeText.replace(/<ul\b[^>]*>([\s\S]*?)<\/ul>/gi, '[list]$1[/list]');
    bbcodeText = bbcodeText.replace(/<li\b[^>]*>(.*?)<\/li>/gi, '[*]$1');

    // Replace <p> tags with BBCode paragraph ([p])
    bbcodeText = bbcodeText.replace(/<p\b[^>]*>(.*?)<\/p>/gi, '[p]$1[/p]');

    // Replace <span style="font-size:Xpx"> with BBCode size ([size=X])
    bbcodeText = bbcodeText.replace(/<span\s+style=(["'])font-size:([\d]+)px\1[^>]*>(.*?)<\/span>/gi, '[size=$2]$3[/size]');

    // Replace <span style="color:X"> with BBCode color ([color=X])
    bbcodeText = bbcodeText.replace(/<color\s+style=(["'])color:(#[0-9A-Fa-f]+|[a-zA-Z]+)\1[^>]*>(.*?)<\/color>/gi, '[color=$2]$3[/color]');

    // Replace <pre> tags with BBCode line breaks (æ¢è¡Œ)
    bbcodeText = bbcodeText.replace(/<pre([\s\S]*?)>/gi, '\n');

    // Remove all other HTML tags
    bbcodeText = bbcodeText.replace(/<\/?[^>]+(>|$)/g, '');

    return bbcodeText;
}
//ä»¥ä¸‹ä»£ç æ¥è‡ªgithub
// Generated by CoffeeScript 1.9.1
(function () {
    bbcode = {};

    if ("undefined" !== typeof module) {
        module.exports = bbcode;
    }

}).call(this);
// Generated by CoffeeScript 1.9.1
(function () {
    var _COSMETIC_DICT, _COSMETIC_RE, _ESCAPE_DICT, _ESCAPE_RE, _URL_RE, key,
        slice = [].slice;

    _ESCAPE_RE = /[&<>"]/g;

    _ESCAPE_DICT = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;'
    };

    _URL_RE = /\b((?:([\w-]+):(\/{1,3})|www[.])(?:(?:(?:[^\s&()]|&amp;|&quot;)*(?:[^!"#$%&'()*+,.:;<=>?@\[\]^`{|}~\s]))|(?:\((?:[^\s&()]|&amp;|&quot;)*\)))+)/g;

    _COSMETIC_DICT = {
        '--': '&ndash;',
        '---': '&mdash;',
        '...': '&#8230;',
        '(c)': '&copy;',
        '(reg)': '&reg;',
        '(tm)': '&trade;'
    };

    _COSMETIC_RE = new RegExp(((function () {
        var results;
        results = [];
        for (key in _COSMETIC_DICT) {
            results.push(key.replace(/(\.|\)|\()/g, '\\$1'));
        }
        return results;
    })()).join('|'));

    bbcode.Renderer = (function () {
        function Renderer(options) {
            options = options || {};

            this._contexts = [];
            this.options = {
                linkify: !!options.linkify
            };
        }

        Renderer.prototype.context = function (context, func) {
            var k, newOptions, ref, v;
            newOptions = {};
            ref = this.options;
            for (k in ref) {
                v = ref[k];
                newOptions[k] = v;
            }
            for (k in context) {
                v = context[k];
                newOptions[k] = v;
            }
            this._contexts.push(this.options);
            this.options = newOptions;
            v = func();
            this.options = this._contexts.pop();
            return v;
        };

        Renderer.prototype.escape = function (value) {
            return value.replace(_ESCAPE_RE, function (match) {
                return _ESCAPE_DICT[match];
            });
        };

        Renderer.prototype.linkify = function (value) {
            return value.replace(_URL_RE, function () {
                var href, match, proto, url;
                match = 1 <= arguments.length ? slice.call(arguments, 0) : [];
                url = match[1];
                proto = match[2];
                if (proto && (proto !== 'http' && proto !== 'https')) {
                    return url;
                }
                href = match[1];
                if (!proto) {
                    href = 'http://' + href;
                }
                return "<a href=\"" + href + "\" target=\"_blank\">" + url + "</a>";
            });
        };

        Renderer.prototype.strip = function (text) {
            return text.replace(/^\s+|\s+$/g, '');
        };

        Renderer.prototype.cosmeticReplace = function (value) {
            return value.replace(_COSMETIC_RE, function () {
                var item, match;
                match = 1 <= arguments.length ? slice.call(arguments, 0) : [];
                item = match[0];
                return _COSMETIC_DICT[item] || item;
            });
        };

        Renderer.prototype.htmlAttributes = function (attributes) {
            var k, v;
            if (!attributes) {
                return '';
            }
            return ((function () {
                var results;
                results = [];
                for (k in attributes) {
                    v = attributes[k];
                    results.push(k + "=\"" + v + "\"");
                }
                return results;
            })()).join(' ');
        };

        return Renderer;

    })();

}).call(this);
// Generated by CoffeeScript 1.9.1
(function () {
    var CenterTag, CodeTag, ColorTag, HorizontalRuleTag, ImageTag, LinkTag, ListItemTag, ListTag, QuoteTag, RightTag, SizeTag, _LINE_BREAK, _NEWLINE_RE,
        indexOf = [].indexOf || function (item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
        extend = function (child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
        hasProp = {}.hasOwnProperty;

    _NEWLINE_RE = /\r?\n/g;

    _LINE_BREAK = '<br />';

    bbcode.Tag = (function () {
        function Tag(renderer, settings) {
            var i, key, len, ref, ref1, value;
            this.renderer = renderer;
            if (settings == null) {
                settings = {};
            }
            this.CLOSED_BY = [];
            this.SELF_CLOSE = false;
            this.STRIP_INNER = false;
            this.STRIP_OUTER = false;
            this.DISCARD_TEXT = false;
            this.name = settings['name'] || null;
            this.parent = settings['parent'] || null;
            this.text = settings['text'] || '';
            if (this.parent) {
                this.parent.children.push(this);
            }
            if (settings['params'] == null) {
                settings['params'] = [];
            }
            this.params = {};
            ref = settings['params'];
            for (i = 0, len = ref.length; i < len; i++) {
                ref1 = ref[i], key = ref1[0], value = ref1[1];
                if (value) {
                    this.params[key] = value;
                }
            }
            this.children = [];
        }

        Tag.prototype.getContent = function (raw) {
            var child, children, content, i, len, pieces, text;
            if (raw == null) {
                raw = false;
            }
            pieces = [];
            if (this.text) {
                text = this.renderer.escape(this.text);
                if (!raw) {
                    if (this.renderer.options['linkify']) {
                        text = this.renderer.linkify(text);
                    }
                    text = this.renderer.cosmeticReplace(text.replace(_NEWLINE_RE, _LINE_BREAK));
                }
                pieces.push(text);
            }
            children = this.children;
            for (i = 0, len = children.length; i < len; i++) {
                child = children[i];
                if (raw) {
                    pieces.push(child.toText());
                } else {
                    if (this.DISCARD_TEXT && child.name === null) {
                        continue;
                    }
                    pieces.push(child.toHTML());
                }
            }
            content = pieces.join('');
            if (!raw && this.STRIP_INNER) {
                content = this.renderer.strip(content);
                while (content.slice(0, _LINE_BREAK.length) === _LINE_BREAK) {
                    content = content.slice(_LINE_BREAK.length);
                }
                while (content.slice(-_LINE_BREAK.length) === _LINE_BREAK) {
                    content = content.slice(0, -_LINE_BREAK.length);
                }
                content = this.renderer.strip(content);
            }
            return content;
        };

        Tag.prototype.toText = function (contentAsHTML) {
            var k, params, pieces, ref, v;
            if (contentAsHTML == null) {
                contentAsHTML = false;
            }
            pieces = [];
            if (this.name !== null) {
                if (this.params.length) {
                    params = ((function () {
                        var ref, results;
                        ref = this.params;
                        results = [];
                        for (k in ref) {
                            v = ref[k];
                            results.push([k, v].join('='));
                        }
                        return results;
                    }).call(this)).join(' ');
                    if (this.name in this.params) {
                        pieces.push("[" + params + "]");
                    } else {
                        pieces.push("[" + this.name + " " + params + "]");
                    }
                } else {
                    pieces.push("[" + this.name + "]");
                }
            }
            pieces.push(this.getContent(!contentAsHTML));
            if (this.name !== null && (ref = this.name, indexOf.call(this.CLOSED_BY, ref) < 0)) {
                pieces.push("[/" + this.name + "]");
            }
            return pieces.join('');
        };

        Tag.prototype._toHTML = function () {
            return this.toText(true);
        };

        Tag.prototype.toHTML = function () {
            var pieces;
            pieces = this._toHTML();
            if (typeof pieces === 'string') {
                return pieces;
            } else {
                return pieces.join('');
            }
        };

        return Tag;

    })();

    CodeTag = (function (superClass) {
        extend(CodeTag, superClass);

        function CodeTag() {
            CodeTag.__super__.constructor.apply(this, arguments);
            this.STRIP_INNER = true;
            this._inline = this.params['code'] === 'inline';
            if (!this._inline) {
                this.STRIP_OUTER = true;
            }
        }

        CodeTag.prototype._toHTML = function () {
            var lang;
            lang = this.params['lang'] || this.params[this.name];
            if (lang) {
                return ["<code><pre class=\"prettyprint lang-" + lang + "\" style=\"background: none;\">", this.getContent(true), '</pre></code>'];
            } else {
                return ['<code><pre style="background: none;">', this.getContent(true), '</pre></code>'];
            }
        };

        return CodeTag;

    })(bbcode.Tag);

    ImageTag = (function (superClass) {
        extend(ImageTag, superClass);

        function ImageTag() {
            return ImageTag.__super__.constructor.apply(this, arguments);
        }

        ImageTag.prototype._toHTML = function () {
            var attributes;
            attributes = {
                src: this.renderer.strip(this.getContent(true))
            };
            if ('width' in this.params) {
                attributes['width'] = this.params['width'];
            }
            if ('height' in this.params) {
                attributes['height'] = this.params['height'];
            }
            return "<img " + (this.renderer.htmlAttributes(attributes)) + " />";
        };

        return ImageTag;

    })(bbcode.Tag);

    SizeTag = (function (superClass) {
        extend(SizeTag, superClass);

        function SizeTag() {
            return SizeTag.__super__.constructor.apply(this, arguments);
        }

        SizeTag.prototype._toHTML = function () {
            var size;
            size = this.params['size'];
            if (isNaN(size)) {
                return this.getContent();
            } else {
                return ["<span style=\"font-size:" + size + "px\">", this.getContent(), '</span>'];
            }
        };

        return SizeTag;

    })(bbcode.Tag);

    ColorTag = (function (superClass) {
        extend(ColorTag, superClass);

        function ColorTag() {
            return ColorTag.__super__.constructor.apply(this, arguments);
        }

        ColorTag.prototype._toHTML = function () {
            var color;
            color = this.params['color'];
            if (color != null) {
                return ["<color style=\"color:" + color + "\">", this.getContent(), '</color>'];
            } else {
                return this.getContent();
            }
        };

        return ColorTag;

    })(bbcode.Tag);

    CenterTag = (function (superClass) {
        extend(CenterTag, superClass);

        function CenterTag() {
            return CenterTag.__super__.constructor.apply(this, arguments);
        }

        CenterTag.prototype._toHTML = function () {
            return ['<div style="text-align:center;">', this.getContent(), '</div>'];
        };

        return CenterTag;

    })(bbcode.Tag);

    RightTag = (function (superClass) {
        extend(RightTag, superClass);

        function RightTag() {
            return RightTag.__super__.constructor.apply(this, arguments);
        }

        RightTag.prototype._toHTML = function () {
            return ['<div style="float:right;">', this.getContent(), '</div>'];
        };

        return RightTag;

    })(bbcode.Tag);

    HorizontalRuleTag = (function (superClass) {
        extend(HorizontalRuleTag, superClass);

        function HorizontalRuleTag() {
            HorizontalRuleTag.__super__.constructor.apply(this, arguments);
            this.SELF_CLOSE = true;
            this.STRIP_OUTER = true;
        }

        HorizontalRuleTag.prototype._toHTML = function () {
            return '<hr />';
        };

        return HorizontalRuleTag;

    })(bbcode.Tag);

    ListTag = (function (superClass) {
        extend(ListTag, superClass);

        function ListTag() {
            ListTag.__super__.constructor.apply(this, arguments);
            this.STRIP_INNER = true;
            this.STRIP_OUTER = true;
        }

        ListTag.prototype._toHTML = function () {
            var listType;
            listType = this.params['list'];
            if (listType === '1') {
                return ['<ol>', this.getContent(), '</ol>'];
            } else if (listType === 'a') {
                return ['<ol style="list-style-type:lower-alpha;">', this.getContent(), '</ol>'];
            } else if (listType === 'A') {
                return ['<ol style="list-style-type:upper-alpha;">', this.getContent(), '</ol>'];
            } else {
                return ['<ul>', this.getContent(), '</ul>'];
            }
        };

        return ListTag;

    })(bbcode.Tag);

    ListItemTag = (function (superClass) {
        extend(ListItemTag, superClass);

        function ListItemTag() {
            ListItemTag.__super__.constructor.apply(this, arguments);
            this.CLOSED_BY = ['*', '/list'];
            this.STRIP_INNER = true;
        }

        ListItemTag.prototype._toHTML = function () {
            return ['<li>', this.getContent(), '</li>'];
        };

        return ListItemTag;

    })(bbcode.Tag);

    QuoteTag = (function (superClass) {
        extend(QuoteTag, superClass);

        function QuoteTag() {
            QuoteTag.__super__.constructor.apply(this, arguments);
            this.STRIP_INNER = true;
            this.STRIP_OUTER = true;
        }

        QuoteTag.prototype._toHTML = function () {
            var citation, pieces;
            pieces = ['<blockquote>', this.getContent()];
            citation = this.params['quote'];
            if (citation) {
                pieces.push('<small>');
                pieces.push(citation);
                pieces.push('</small>');
            }
            pieces.push('</blockquote>');
            return pieces;
        };

        return QuoteTag;

    })(bbcode.Tag);

    LinkTag = (function (superClass) {
        extend(LinkTag, superClass);

        function LinkTag() {
            return LinkTag.__super__.constructor.apply(this, arguments);
        }

        LinkTag.prototype._toHTML = function () {
            var url;
            url = this.renderer.strip(this.params[this.name] || this.getContent(true));
            if (/javascript:/i.test(url)) {
                url = '';
            }
            if (url) {
                return this.renderer.context({
                    'linkify': false
                }, (function (_this) {
                    return function () {
                        return ["<a href=\"" + url + "\" target=\"_blank\">", _this.getContent(), '</a>'];
                    };
                })(this));
            } else {
                return this.getContent();
            }
        };

        return LinkTag;

    })(bbcode.Tag);

    bbcode.createSimpleTag = (function (_this) {
        return function (name, attributes) {
            var SimpleTag;
            return SimpleTag = (function (superClass) {
                extend(SimpleTag, superClass);

                function SimpleTag() {
                    var k, v;
                    SimpleTag.__super__.constructor.apply(this, arguments);
                    for (k in attributes) {
                        v = attributes[k];
                        this[k] = v;
                    }
                }

                SimpleTag.prototype._toHTML = function () {
                    var htmlAttributes;
                    htmlAttributes = this.renderer.htmlAttributes(this.params);
                    if (htmlAttributes) {
                        htmlAttributes = ' ' + htmlAttributes;
                    }
                    return ["<" + name + htmlAttributes + ">", this.getContent(), "</" + name + ">"];
                };

                return SimpleTag;

            })(bbcode.Tag);
        };
    })(this);

    bbcode.BUILTIN = {
        b: bbcode.createSimpleTag('strong'),
        i: bbcode.createSimpleTag('em'),
        u: bbcode.createSimpleTag('u'),
        s: bbcode.createSimpleTag('strike'),
        h1: bbcode.createSimpleTag('h1', {
            STRIP_OUTER: true
        }),
        h2: bbcode.createSimpleTag('h2', {
            STRIP_OUTER: true
        }),
        h3: bbcode.createSimpleTag('h3', {
            STRIP_OUTER: true
        }),
        h4: bbcode.createSimpleTag('h4', {
            STRIP_OUTER: true
        }),
        h5: bbcode.createSimpleTag('h5', {
            STRIP_OUTER: true
        }),
        h6: bbcode.createSimpleTag('h6', {
            STRIP_OUTER: true
        }),
        pre: bbcode.createSimpleTag('pre'),
        table: bbcode.createSimpleTag('table', {
            DISCARD_TEXT: true
        }),
        thead: bbcode.createSimpleTag('thead', {
            DISCARD_TEXT: true
        }),
        tbody: bbcode.createSimpleTag('tbody', {
            DISCARD_TEXT: true
        }),
        tr: bbcode.createSimpleTag('tr', {
            DISCARD_TEXT: true
        }),
        th: bbcode.createSimpleTag('th'),
        td: bbcode.createSimpleTag('td'),
        code: CodeTag,
        img: ImageTag,
        hr: HorizontalRuleTag,
        size: SizeTag,
        center: CenterTag,
        right: RightTag,
        color: ColorTag,
        list: ListTag,
        '*': ListItemTag,
        quote: QuoteTag,
        url: LinkTag,
        link: LinkTag
    };

}).call(this);
// Generated by CoffeeScript 1.9.1
(function () {
    var _SPACE_RE, _START_NEWLINE_RE, _TOKEN_RE,
        indexOf = [].indexOf || function (item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

    _SPACE_RE = /^\s*$/;

    _TOKEN_RE = /(\[\/?.+?\])/;

    _START_NEWLINE_RE = /^\r?\n/;

    bbcode.Parser = (function () {
        function Parser(allowedTags) {
            var i, len, name, ref, tag;
            if (allowedTags == null) {
                allowedTags = null;
            }
            this.tags = {};
            if (!allowedTags) {
                ref = bbcode.BUILTIN;
                for (name in ref) {
                    tag = ref[name];
                    this.registerTag(name, tag);
                }
            } else {
                for (i = 0, len = allowedTags.length; i < len; i++) {
                    name = allowedTags[i];
                    if (indexOf.call(bbcode.BUILTIN, name) >= 0) {
                        this.registerTag(name, bbcode.BUILTIN[name]);
                    }
                }
            }
            this.renderer = new bbcode.Renderer();
        }

        Parser.prototype.registerTag = function (name, tag) {
            return this.tags[name] = tag;
        };

        Parser.prototype._parseParams = function (token) {
            var c, i, key, len, params, skipNext, target, terminate, value;
            params = [];
            if (token) {
                target = key = [];
                value = [];
                terminate = ' ';
                skipNext = false;
                for (i = 0, len = token.length; i < len; i++) {
                    c = token[i];
                    if (skipNext) {
                        skipNext = false;
                    } else if (target === key && c === '=') {
                        target = value;
                    } else if (target === key && c === ':') {
                        target = value;
                    } else if (!value.length && c === '"') {
                        terminate = c;
                    } else if (c !== terminate) {
                        target.push(c);
                    } else {
                        params.push([key.join('').toLowerCase(), value.join('')]);
                        if (!_SPACE_RE.test(terminate)) {
                            skipNext = true;
                        }
                        target = key = [];
                        value = [];
                        terminate = ' ';
                    }
                }
                params.push([key.join('').toLowerCase(), value.join('')]);
            }
            return params;
        };

        Parser.prototype._createTextNode = function (parent, text) {
            var ref;
            if ((ref = parent.children.slice(-1)[0]) != null ? ref.STRIP_OUTER : void 0) {
                text = text.replace(_START_NEWLINE_RE, '');
            }
            return new bbcode.Tag(this.renderer, {
                text: text,
                parent: parent
            });
        };

        Parser.prototype.parse = function (input) {
            var cls, current, params, root, tag, tagName, token, tokens;
            current = root = new bbcode.Tag(this.renderer);
            tokens = input.split(_TOKEN_RE);
            while (tokens.length) {
                token = tokens.shift();
                if (token.match(_TOKEN_RE)) {
                    params = this._parseParams(token.slice(1, -1));
                    tagName = params[0][0];
                    if (indexOf.call(current.CLOSED_BY, tagName) >= 0) {
                        tokens.unshift(token);
                        tagName = '/' + current.name;
                        params = [];
                    }
                    if (tagName[0] === '/') {
                        tagName = tagName.slice(1);
                        if (!(tagName in this.tags)) {
                            this._createTextNode(current, token);
                            continue;
                        }
                        if (current.name === tagName) {
                            current = current.parent;
                        }
                    } else {
                        cls = this.tags[tagName];
                        if (!cls) {
                            this._createTextNode(current, token);
                            continue;
                        }
                        tag = new cls(this.renderer, {
                            name: tagName,
                            parent: current,
                            params: params
                        });
                        if (!tag.SELF_CLOSE && (indexOf.call(tag.CLOSED_BY, tagName) < 0 || current.name !== tagName)) {
                            current = tag;
                        }
                    }
                } else {
                    this._createTextNode(current, token);
                }
            }
            return root;
        };

        Parser.prototype.toHTML = function (input) {
            var html;
            return html = this.parse(input).toHTML();
        };

        return Parser;

    })();

}).call(this);
// Generated by CoffeeScript 1.9.1
(function () {
    var MARKUP;

    MARKUP = {
        bold: {
            keyCode: 66,
            title: 'Bold (Ctrl+B)',
            placeholder: 'bold text',
            open: '[b]',
            close: '[/b]'
        },
        italic: {
            keyCode: 73,
            title: 'Italic (Ctrl+I)',
            placeholder: 'italic text',
            open: '[i]',
            close: '[/i]'
        },
        center: {
            keyCode: 69,
            title: 'Center (Ctrl+E)',
            placeholder: 'center text',
            open: '[center]',
            close: '[/center]'
        },
        hyperlink: {
            keyCode: 76,
            title: 'Hyperlink (Ctrl+L)',
            placeholder: 'link text',
            open: function () {
                var url;
                url = prompt('Please enter the URL of your link', 'http://') || 'link url';
                return "[url=" + url + "]";
            },
            close: '[/url]'
        },
        blockquote: {
            keyCode: 190,
            title: 'Blockquote (Ctrl+.)',
            placeholder: 'blockquote',
            open: '[quote]',
            close: '[/quote]'
        },
        code: {
            keyCode: 76,
            title: 'Code (Ctrl+K)',
            placeholder: 'print("code sample");',
            open: '[code]',
            close: '[/code]'
        },
        image: {
            keyCode: 71,
            placeholder: 'image url',
            open: '[img]',
            close: '[/img]'
        },
        nlist: {
            keyCode: 79,
            title: 'Numbered List (Ctrl+O)',
            placeholder: 'list item',
            open: function (value) {
                var close, open, ref, ref1;
                open = ((ref = value.match(/\[list=1\]/g)) != null ? ref.length : void 0) || 0;
                close = ((ref1 = value.match(/\[\/list\]/g)) != null ? ref1.length : void 0) || 0;
                if (open === close) {
                    return '[list=1]\n\t[*]';
                }
                return '\t[*]';
            },
            close: function (value) {
                var close, open, ref, ref1;
                open = ((ref = value.match(/\[list=1\]/g)) != null ? ref.length : void 0) || 0;
                close = ((ref1 = value.match(/\[\/list\]/g)) != null ? ref1.length : void 0) || 0;
                if (open === close) {
                    return '\n[/list]';
                }
            }
        },
        list: {
            keyCode: 85,
            title: 'Bulleted List (Ctrl+O)',
            placeholder: 'list item',
            open: function (value) {
                var close, open, ref, ref1;
                open = ((ref = value.match(/\[list\]/g)) != null ? ref.length : void 0) || 0;
                close = ((ref1 = value.match(/\[\/list\]/g)) != null ? ref1.length : void 0) || 0;
                if (open === close) {
                    return '[list]\n\t[*]';
                }
                return '\t[*]';
            },
            close: function (value) {
                var close, open, ref, ref1;
                open = ((ref = value.match(/\[list\]/g)) != null ? ref.length : void 0) || 0;
                close = ((ref1 = value.match(/\[\/list\]/g)) != null ? ref1.length : void 0) || 0;
                if (open === close) {
                    return '\n[/list]';
                }
            }
        },
        heading: {
            keyCode: 72,
            title: 'Heading (Ctrl+H)',
            placeholder: 'heading',
            open: '[h3]',
            close: '[/h3]',
            before: /\n$/,
            after: /^\n/
        },
        hrule: {
            keyCode: 82,
            title: 'Hprizontal Rule (Ctrl+R)',
            open: '[hr]\n',
            before: /\n\n$/,
            after: /^\n\n/
        }
    };

    bbcode.Editor = (function () {
        function Editor(textarea, markup) {
            this.markup = markup != null ? markup : MARKUP;
            this.$ = $(textarea);
            this.textarea = this.$[0];
            this.$.on('keydown', (function (_this) {
                return function (e) {
                    var end, i, len, length, line, lines, offset, ref, ref1, ref2, ref3, selection, start, tab;
                    if (e.which === 9) {
                        selection = _this.getSelection();
                        offset = 0;
                        if (selection.start === selection.end && !e.shiftKey) {
                            offset++;
                            selection.value[1] = "\t" + selection.value[1];
                            _this.setValue(selection.value.join(''));
                        } else {
                            length = 0;
                            tab = false;
                            lines = [];
                            ref = _this.textarea.value.split('\n');
                            for (i = 0, len = ref.length; i < len; i++) {
                                line = ref[i];
                                ref1 = [length, length += line.length + 1], start = ref1[0], end = ref1[1];
                                if (!tab && (start <= (ref2 = selection.start) && ref2 < end)) {
                                    tab = true;
                                }
                                if (tab) {
                                    if (e.shiftKey) {
                                        if (line[0] === '\t') {
                                            line = line.slice(1);
                                            offset--;
                                        }
                                    } else {
                                        line = "\t" + line;
                                        offset++;
                                    }
                                    tab = !((start <= (ref3 = selection.end) && ref3 <= end));
                                }
                                lines.push(line);
                            }
                            _this.setValue(lines.join('\n'));
                        }
                        if (offset > 0) {
                            selection.start++;
                        } else if (offset < 0) {
                            selection.start--;
                        }
                        _this.select(selection.start, selection.end + offset);
                    } else if (!e.ctrlKey || e.altKey || (_this.getRule(e.which) == null)) {
                        return true;
                    } else {
                        _this.replace(e.which);
                    }
                    return false;
                };
            })(this));
        }

        Editor.prototype._escapeRe = function (pattern) {
            var escaped, special;
            special = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\', '^', '$'];
            escaped = pattern.replace(new RegExp('(\\' + special.join('|\\') + ')', 'g'), '\\$1');
            return new RegExp('^' + escaped.replace(/\d+/, '\\d+') + '$');
        };

        Editor.prototype.getRule = function (keyCode) {
            var key, ref, rule;
            ref = this.markup;
            for (key in ref) {
                rule = ref[key];
                if (rule.keyCode === keyCode) {
                    return rule;
                }
            }
        };

        Editor.prototype.replace = function (keyCode, value, text) {
            var close, open, replacement, rule, selection, start;
            this.$.focus();
            selection = this.getSelection();
            rule = this.getRule(keyCode);
            value = this.textarea.value;
            open = (typeof rule.open === 'function' ? rule.open(selection.value[0]) : rule.open) || '';
            close = (typeof rule.close === 'function' ? rule.close(selection.value[2]) : rule.close) || '';
            if (this._escapeRe(open).test(value.slice(selection.start - open.length, selection.start)) && this._escapeRe(close).test(value.slice(selection.end, selection.end + close.length))) {
                start = selection.start - open.length;
                this.setValue(value.substr(0, start) + selection.value[1] + value.substr(selection.end + close.length, value.length));
                return this.select(start, start + selection.value[1].length);
            } else {
                replacement = open + (text || selection.value[1] || rule.placeholder || '') + close;
                if ((rule.before != null) && !rule.before.test(selection.value[0])) {
                    replacement = "\n\n" + replacement;
                    selection.start += 2;
                }
                if ((rule.after != null) && !rule.after.test(selection.value[2])) {
                    replacement += '\n\n';
                    selection.end += 2;
                }
                this.setValue(selection.value[0] + replacement + selection.value[2]);
                return this.select(selection.start + open.length, selection.start + replacement.length - close.length);
            }
        };

        Editor.prototype.setValue = function (value) {
            var position;
            position = this.$.scrollTop();
            this.$.val(value);
            return this.$.scrollTop(position);
        };

        Editor.prototype.select = function (start, end) {
            var range, ref;
            if (((ref = document.selection) != null ? ref.createRange : void 0) != null) {
                range = this.textarea.createTextRange();
                range.collapse(true);
                range.moveStart('character', start);
                range.moveEnd('character', end - start);
                return range.select();
            } else {
                this.textarea.selectionStart = start;
                return this.textarea.selectionEnd = end;
            }
        };

        Editor.prototype.getSelection = function () {
            var close, end, open, range, ref, selection, start, storedRange, value;
            value = this.textarea.value;
            if (((ref = document.selection) != null ? ref.createRange : void 0) != null) {
                selection = document.selection;
                if (!/testarea/i.test(this.textarea.tagName)) {
                    range = selection.createRange().duplicate();
                    range.moveEnd('character', value.length);
                    start = range.text === '' ? value.length : value.lastIndexOf(range.text);
                    range = selection.createRange().duplicate();
                    range.moveStart('character', -value.length);
                    end = range.text.length + 1;
                } else {
                    range = selection.createRange();
                    storedRange = range.duplicate();
                    storedRange.moveToElementText(this.textarea);
                    storedRange.setEndPoint('EndToEnd', range);
                    start = storedRange.text.length - range.text.length;
                    end = start + range.text.length;
                }
            } else {
                start = this.textarea.selectionStart;
                end = this.textarea.selectionEnd;
            }
            open = value.substring(0, start);
            close = value.substring(end, value.length);
            return selection = {
                start: start,
                end: end,
                value: [open, value.substring(start, end), close]
            };
        };

        return Editor;

    })();

}).call(this);

//ä»¥ä¸‹ä¸ºhttps://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.cssï¼ˆä»£ç é«˜äº®ï¼‰

var _self = "undefined" != typeof window ? window : "undefined" != typeof WorkerGlobalScope && self instanceof WorkerGlobalScope ? self : {},
    Prism = function (e) {
        var n = /(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,
            t = 0,
            r = {},
            a = {
                manual: e.Prism && e.Prism.manual,
                disableWorkerMessageHandler: e.Prism && e.Prism.disableWorkerMessageHandler,
                util: {
                    encode: function e(n) {
                        return n instanceof i ? new i(n.type, e(n.content), n.alias) : Array.isArray(n) ? n.map(e) : n.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/\u00a0/g, " ")
                    },
                    type: function (e) {
                        return Object.prototype.toString.call(e).slice(8, -1)
                    },
                    objId: function (e) {
                        return e.__id || Object.defineProperty(e, "__id", {
                            value: ++t
                        }), e.__id
                    },
                    clone: function e(n, t) {
                        var r, i;
                        switch (t = t || {}, a.util.type(n)) {
                            case "Object":
                                if (i = a.util.objId(n), t[i]) return t[i];
                                for (var l in r = {}, t[i] = r, n) n.hasOwnProperty(l) && (r[l] = e(n[l], t));
                                return r;
                            case "Array":
                                return i = a.util.objId(n), t[i] ? t[i] : (r = [], t[i] = r, n.forEach((function (n, a) {
                                    r[a] = e(n, t)
                                })), r);
                            default:
                                return n
                        }
                    },
                    getLanguage: function (e) {
                        for (; e;) {
                            var t = n.exec(e.className);
                            if (t) return t[1].toLowerCase();
                            e = e.parentElement
                        }
                        return "none"
                    },
                    setLanguage: function (e, t) {
                        e.className = e.className.replace(RegExp(n, "gi"), ""), e.classList.add("language-" + t)
                    },
                    currentScript: function () {
                        if ("undefined" == typeof document) return null;
                        if ("currentScript" in document) return document.currentScript;
                        try {
                            throw new Error
                        } catch (r) {
                            var e = (/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(r.stack) || [])[1];
                            if (e) {
                                var n = document.getElementsByTagName("script");
                                for (var t in n)
                                    if (n[t].src == e) return n[t]
                            }
                            return null
                        }
                    },
                    isActive: function (e, n, t) {
                        for (var r = "no-" + n; e;) {
                            var a = e.classList;
                            if (a.contains(n)) return !0;
                            if (a.contains(r)) return !1;
                            e = e.parentElement
                        }
                        return !!t
                    }
                },
                languages: {
                    plain: r,
                    plaintext: r,
                    text: r,
                    txt: r,
                    extend: function (e, n) {
                        var t = a.util.clone(a.languages[e]);
                        for (var r in n) t[r] = n[r];
                        return t
                    },
                    insertBefore: function (e, n, t, r) {
                        var i = (r = r || a.languages)[e],
                            l = {};
                        for (var o in i)
                            if (i.hasOwnProperty(o)) {
                                if (o == n)
                                    for (var s in t) t.hasOwnProperty(s) && (l[s] = t[s]);
                                t.hasOwnProperty(o) || (l[o] = i[o])
                            } var u = r[e];
                        return r[e] = l, a.languages.DFS(a.languages, (function (n, t) {
                            t === u && n != e && (this[n] = l)
                        })), l
                    },
                    DFS: function e(n, t, r, i) {
                        i = i || {};
                        var l = a.util.objId;
                        for (var o in n)
                            if (n.hasOwnProperty(o)) {
                                t.call(n, o, n[o], r || o);
                                var s = n[o],
                                    u = a.util.type(s);
                                "Object" !== u || i[l(s)] ? "Array" !== u || i[l(s)] || (i[l(s)] = !0, e(s, t, o, i)) : (i[l(s)] = !0, e(s, t, null, i))
                            }
                    }
                },
                plugins: {},
                highlightAll: function (e, n) {
                    a.highlightAllUnder(document, e, n)
                },
                highlightAllUnder: function (e, n, t) {
                    var r = {
                        callback: t,
                        container: e,
                        selector: 'pre[class*="language-"], [class*="language-"] pre, pre[class*="lang-"], [class*="lang-"] pre'
                    };
                    a.hooks.run("before-highlightall", r), r.elements = Array.prototype.slice.apply(r.container.querySelectorAll(r.selector)), a.hooks.run("before-all-elements-highlight", r);
                    for (var i, l = 0; i = r.elements[l++];) a.highlightElement(i, !0 === n, r.callback)
                },
                highlightElement: function (n, t, r) {
                    var i = a.util.getLanguage(n),
                        l = a.languages[i];
                    a.util.setLanguage(n, i);
                    var o = n.parentElement;
                    o && "pre" === o.nodeName.toLowerCase() && a.util.setLanguage(o, i);
                    var s = {
                        element: n,
                        language: i,
                        grammar: l,
                        code: n.textContent
                    };

                    function u(e) {
                        s.highlightedCode = e, a.hooks.run("before-insert", s), s.element.innerHTML = s.highlightedCode, a.hooks.run("after-highlight", s), a.hooks.run("complete", s), r && r.call(s.element)
                    }
                    if (a.hooks.run("before-sanity-check", s), (o = s.element.parentElement) && "pre" === o.nodeName.toLowerCase() && !o.hasAttribute("tabindex") && o.setAttribute("tabindex", "0"), !s.code) return a.hooks.run("complete", s), void (r && r.call(s.element));
                    if (a.hooks.run("before-highlight", s), s.grammar)
                        if (t && e.Worker) {
                            var c = new Worker(a.filename);
                            c.onmessage = function (e) {
                                u(e.data)
                            }, c.postMessage(JSON.stringify({
                                language: s.language,
                                code: s.code,
                                immediateClose: !0
                            }))
                        } else u(a.highlight(s.code, s.grammar, s.language));
                    else u(a.util.encode(s.code))
                },
                highlight: function (e, n, t) {
                    var r = {
                        code: e,
                        grammar: n,
                        language: t
                    };
                    if (a.hooks.run("before-tokenize", r), !r.grammar) throw new Error('The language "' + r.language + '" has no grammar.');
                    return r.tokens = a.tokenize(r.code, r.grammar), a.hooks.run("after-tokenize", r), i.stringify(a.util.encode(r.tokens), r.language)
                },
                tokenize: function (e, n) {
                    var t = n.rest;
                    if (t) {
                        for (var r in t) n[r] = t[r];
                        delete n.rest
                    }
                    var a = new s;
                    return u(a, a.head, e), o(e, a, n, a.head, 0),
                        function (e) {
                            for (var n = [], t = e.head.next; t !== e.tail;) n.push(t.value), t = t.next;
                            return n
                        }(a)
                },
                hooks: {
                    all: {},
                    add: function (e, n) {
                        var t = a.hooks.all;
                        t[e] = t[e] || [], t[e].push(n)
                    },
                    run: function (e, n) {
                        var t = a.hooks.all[e];
                        if (t && t.length)
                            for (var r, i = 0; r = t[i++];) r(n)
                    }
                },
                Token: i
            };

        function i(e, n, t, r) {
            this.type = e, this.content = n, this.alias = t, this.length = 0 | (r || "").length
        }

        function l(e, n, t, r) {
            e.lastIndex = n;
            var a = e.exec(t);
            if (a && r && a[1]) {
                var i = a[1].length;
                a.index += i, a[0] = a[0].slice(i)
            }
            return a
        }

        function o(e, n, t, r, s, g) {
            for (var f in t)
                if (t.hasOwnProperty(f) && t[f]) {
                    var h = t[f];
                    h = Array.isArray(h) ? h : [h];
                    for (var d = 0; d < h.length; ++d) {
                        if (g && g.cause == f + "," + d) return;
                        var v = h[d],
                            p = v.inside,
                            m = !!v.lookbehind,
                            y = !!v.greedy,
                            k = v.alias;
                        if (y && !v.pattern.global) {
                            var x = v.pattern.toString().match(/[imsuy]*$/)[0];
                            v.pattern = RegExp(v.pattern.source, x + "g")
                        }
                        for (var b = v.pattern || v, w = r.next, A = s; w !== n.tail && !(g && A >= g.reach); A += w.value.length, w = w.next) {
                            var E = w.value;
                            if (n.length > e.length) return;
                            if (!(E instanceof i)) {
                                var P, L = 1;
                                if (y) {
                                    if (!(P = l(b, A, e, m)) || P.index >= e.length) break;
                                    var S = P.index,
                                        O = P.index + P[0].length,
                                        j = A;
                                    for (j += w.value.length; S >= j;) j += (w = w.next).value.length;
                                    if (A = j -= w.value.length, w.value instanceof i) continue;
                                    for (var C = w; C !== n.tail && (j < O || "string" == typeof C.value); C = C.next) L++, j += C.value.length;
                                    L--, E = e.slice(A, j), P.index -= A
                                } else if (!(P = l(b, 0, E, m))) continue;
                                S = P.index;
                                var N = P[0],
                                    _ = E.slice(0, S),
                                    M = E.slice(S + N.length),
                                    W = A + E.length;
                                g && W > g.reach && (g.reach = W);
                                var z = w.prev;
                                if (_ && (z = u(n, z, _), A += _.length), c(n, z, L), w = u(n, z, new i(f, p ? a.tokenize(N, p) : N, k, N)), M && u(n, w, M), L > 1) {
                                    var I = {
                                        cause: f + "," + d,
                                        reach: W
                                    };
                                    o(e, n, t, w.prev, A, I), g && I.reach > g.reach && (g.reach = I.reach)
                                }
                            }
                        }
                    }
                }
        }

        function s() {
            var e = {
                value: null,
                prev: null,
                next: null
            },
                n = {
                    value: null,
                    prev: e,
                    next: null
                };
            e.next = n, this.head = e, this.tail = n, this.length = 0
        }

        function u(e, n, t) {
            var r = n.next,
                a = {
                    value: t,
                    prev: n,
                    next: r
                };
            return n.next = a, r.prev = a, e.length++, a
        }

        function c(e, n, t) {
            for (var r = n.next, a = 0; a < t && r !== e.tail; a++) r = r.next;
            n.next = r, r.prev = n, e.length -= a
        }
        if (e.Prism = a, i.stringify = function e(n, t) {
            if ("string" == typeof n) return n;
            if (Array.isArray(n)) {
                var r = "";
                return n.forEach((function (n) {
                    r += e(n, t)
                })), r
            }
            var i = {
                type: n.type,
                content: e(n.content, t),
                tag: "span",
                classes: ["token", n.type],
                attributes: {},
                language: t
            },
                l = n.alias;
            l && (Array.isArray(l) ? Array.prototype.push.apply(i.classes, l) : i.classes.push(l)), a.hooks.run("wrap", i);
            var o = "";
            for (var s in i.attributes) o += " " + s + '="' + (i.attributes[s] || "").replace(/"/g, "&quot;") + '"';
            return "<" + i.tag + ' class="' + i.classes.join(" ") + '"' + o + ">" + i.content + "</" + i.tag + ">"
        }, !e.document) return e.addEventListener ? (a.disableWorkerMessageHandler || e.addEventListener("message", (function (n) {
            var t = JSON.parse(n.data),
                r = t.language,
                i = t.code,
                l = t.immediateClose;
            e.postMessage(a.highlight(i, a.languages[r], r)), l && e.close()
        }), !1), a) : a;
        var g = a.util.currentScript();

        function f() {
            a.manual || a.highlightAll()
        }
        if (g && (a.filename = g.src, g.hasAttribute("data-manual") && (a.manual = !0)), !a.manual) {
            var h = document.readyState;
            "loading" === h || "interactive" === h && g && g.defer ? document.addEventListener("DOMContentLoaded", f) : window.requestAnimationFrame ? window.requestAnimationFrame(f) : window.setTimeout(f, 16)
        }
        return a
    }(_self);
"undefined" != typeof module && module.exports && (module.exports = Prism), "undefined" != typeof global && (global.Prism = Prism);
Prism.languages.markup = {
    comment: {
        pattern: /<!--(?:(?!<!--)[\s\S])*?-->/,
        greedy: !0
    },
    prolog: {
        pattern: /<\?[\s\S]+?\?>/,
        greedy: !0
    },
    doctype: {
        pattern: /<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,
        greedy: !0,
        inside: {
            "internal-subset": {
                pattern: /(^[^\[]*\[)[\s\S]+(?=\]>$)/,
                lookbehind: !0,
                greedy: !0,
                inside: null
            },
            string: {
                pattern: /"[^"]*"|'[^']*'/,
                greedy: !0
            },
            punctuation: /^<!|>$|[[\]]/,
            "doctype-tag": /^DOCTYPE/i,
            name: /[^\s<>'"]+/
        }
    },
    cdata: {
        pattern: /<!\[CDATA\[[\s\S]*?\]\]>/i,
        greedy: !0
    },
    tag: {
        pattern: /<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,
        greedy: !0,
        inside: {
            tag: {
                pattern: /^<\/?[^\s>\/]+/,
                inside: {
                    punctuation: /^<\/?/,
                    namespace: /^[^\s>\/:]+:/
                }
            },
            "special-attr": [],
            "attr-value": {
                pattern: /=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,
                inside: {
                    punctuation: [{
                        pattern: /^=/,
                        alias: "attr-equals"
                    }, {
                        pattern: /^(\s*)["']|["']$/,
                        lookbehind: !0
                    }]
                }
            },
            punctuation: /\/?>/,
            "attr-name": {
                pattern: /[^\s>\/]+/,
                inside: {
                    namespace: /^[^\s>\/:]+:/
                }
            }
        }
    },
    entity: [{
        pattern: /&[\da-z]{1,8};/i,
        alias: "named-entity"
    }, /&#x?[\da-f]{1,8};/i]
}, Prism.languages.markup.tag.inside["attr-value"].inside.entity = Prism.languages.markup.entity, Prism.languages.markup.doctype.inside["internal-subset"].inside = Prism.languages.markup, Prism.hooks.add("wrap", (function (a) {
    "entity" === a.type && (a.attributes.title = a.content.replace(/&amp;/, "&"))
})), Object.defineProperty(Prism.languages.markup.tag, "addInlined", {
    value: function (a, e) {
        var s = {};
        s["language-" + e] = {
            pattern: /(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,
            lookbehind: !0,
            inside: Prism.languages[e]
        }, s.cdata = /^<!\[CDATA\[|\]\]>$/i;
        var t = {
            "included-cdata": {
                pattern: /<!\[CDATA\[[\s\S]*?\]\]>/i,
                inside: s
            }
        };
        t["language-" + e] = {
            pattern: /[\s\S]+/,
            inside: Prism.languages[e]
        };
        var n = {};
        n[a] = {
            pattern: RegExp("(<__[^>]*>)(?:<!\\[CDATA\\[(?:[^\\]]|\\](?!\\]>))*\\]\\]>|(?!<!\\[CDATA\\[)[^])*?(?=</__>)".replace(/__/g, (function () {
                return a
            })), "i"),
            lookbehind: !0,
            greedy: !0,
            inside: t
        }, Prism.languages.insertBefore("markup", "cdata", n)
    }
}), Object.defineProperty(Prism.languages.markup.tag, "addAttribute", {
    value: function (a, e) {
        Prism.languages.markup.tag.inside["special-attr"].push({
            pattern: RegExp("(^|[\"'\\s])(?:" + a + ")\\s*=\\s*(?:\"[^\"]*\"|'[^']*'|[^\\s'\">=]+(?=[\\s>]))", "i"),
            lookbehind: !0,
            inside: {
                "attr-name": /^[^\s=]+/,
                "attr-value": {
                    pattern: /=[\s\S]+/,
                    inside: {
                        value: {
                            pattern: /(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,
                            lookbehind: !0,
                            alias: [e, "language-" + e],
                            inside: Prism.languages[e]
                        },
                        punctuation: [{
                            pattern: /^=/,
                            alias: "attr-equals"
                        }, /"|'/]
                    }
                }
            }
        })
    }
}), Prism.languages.html = Prism.languages.markup, Prism.languages.mathml = Prism.languages.markup, Prism.languages.svg = Prism.languages.markup, Prism.languages.xml = Prism.languages.extend("markup", {}), Prism.languages.ssml = Prism.languages.xml, Prism.languages.atom = Prism.languages.xml, Prism.languages.rss = Prism.languages.xml;
! function (s) {
    var e = /(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;
    s.languages.css = {
        comment: /\/\*[\s\S]*?\*\//,
        atrule: {
            pattern: RegExp("@[\\w-](?:[^;{\\s\"']|\\s+(?!\\s)|" + e.source + ")*?(?:;|(?=\\s*\\{))"),
            inside: {
                rule: /^@[\w-]+/,
                "selector-function-argument": {
                    pattern: /(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,
                    lookbehind: !0,
                    alias: "selector"
                },
                keyword: {
                    pattern: /(^|[^\w-])(?:and|not|only|or)(?![\w-])/,
                    lookbehind: !0
                }
            }
        },
        url: {
            pattern: RegExp("\\burl\\((?:" + e.source + "|(?:[^\\\\\r\n()\"']|\\\\[^])*)\\)", "i"),
            greedy: !0,
            inside: {
                function: /^url/i,
                punctuation: /^\(|\)$/,
                string: {
                    pattern: RegExp("^" + e.source + "$"),
                    alias: "url"
                }
            }
        },
        selector: {
            pattern: RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|" + e.source + ")*(?=\\s*\\{)"),
            lookbehind: !0
        },
        string: {
            pattern: e,
            greedy: !0
        },
        property: {
            pattern: /(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,
            lookbehind: !0
        },
        important: /!important\b/i,
        function: {
            pattern: /(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,
            lookbehind: !0
        },
        punctuation: /[(){};:,]/
    }, s.languages.css.atrule.inside.rest = s.languages.css;
    var t = s.languages.markup;
    t && (t.tag.addInlined("style", "css"), t.tag.addAttribute("style", "css"))
}(Prism);
Prism.languages.clike = {
    comment: [{
        pattern: /(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,
        lookbehind: !0,
        greedy: !0
    }, {
        pattern: /(^|[^\\:])\/\/.*/,
        lookbehind: !0,
        greedy: !0
    }],
    string: {
        pattern: /(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,
        greedy: !0
    },
    "class-name": {
        pattern: /(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,
        lookbehind: !0,
        inside: {
            punctuation: /[.\\]/
        }
    },
    keyword: /\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,
    boolean: /\b(?:false|true)\b/,
    function: /\b\w+(?=\()/,
    number: /\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,
    operator: /[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,
    punctuation: /[{}[\];(),.:]/
};
Prism.languages.javascript = Prism.languages.extend("clike", {
    "class-name": [Prism.languages.clike["class-name"], {
        pattern: /(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,
        lookbehind: !0
    }],
    keyword: [{
        pattern: /((?:^|\})\s*)catch\b/,
        lookbehind: !0
    }, {
        pattern: /(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,
        lookbehind: !0
    }],
    function: /#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,
    number: {
        pattern: RegExp("(^|[^\\w$])(?:NaN|Infinity|0[bB][01]+(?:_[01]+)*n?|0[oO][0-7]+(?:_[0-7]+)*n?|0[xX][\\dA-Fa-f]+(?:_[\\dA-Fa-f]+)*n?|\\d+(?:_\\d+)*n|(?:\\d+(?:_\\d+)*(?:\\.(?:\\d+(?:_\\d+)*)?)?|\\.\\d+(?:_\\d+)*)(?:[Ee][+-]?\\d+(?:_\\d+)*)?)(?![\\w$])"),
        lookbehind: !0
    },
    operator: /--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/
}), Prism.languages.javascript["class-name"][0].pattern = /(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/, Prism.languages.insertBefore("javascript", "keyword", {
    regex: {
        pattern: RegExp("((?:^|[^$\\w\\xA0-\\uFFFF.\"'\\])\\s]|\\b(?:return|yield))\\s*)/(?:(?:\\[(?:[^\\]\\\\\r\n]|\\\\.)*\\]|\\\\.|[^/\\\\\\[\r\n])+/[dgimyus]{0,7}|(?:\\[(?:[^[\\]\\\\\r\n]|\\\\.|\\[(?:[^[\\]\\\\\r\n]|\\\\.|\\[(?:[^[\\]\\\\\r\n]|\\\\.)*\\])*\\])*\\]|\\\\.|[^/\\\\\\[\r\n])+/[dgimyus]{0,7}v[dgimyus]{0,7})(?=(?:\\s|/\\*(?:[^*]|\\*(?!/))*\\*/)*(?:$|[\r\n,.;:})\\]]|//))"),
        lookbehind: !0,
        greedy: !0,
        inside: {
            "regex-source": {
                pattern: /^(\/)[\s\S]+(?=\/[a-z]*$)/,
                lookbehind: !0,
                alias: "language-regex",
                inside: Prism.languages.regex
            },
            "regex-delimiter": /^\/|\/$/,
            "regex-flags": /^[a-z]+$/
        }
    },
    "function-variable": {
        pattern: /#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,
        alias: "function"
    },
    parameter: [{
        pattern: /(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,
        lookbehind: !0,
        inside: Prism.languages.javascript
    }, {
        pattern: /(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,
        lookbehind: !0,
        inside: Prism.languages.javascript
    }, {
        pattern: /(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,
        lookbehind: !0,
        inside: Prism.languages.javascript
    }, {
        pattern: /((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,
        lookbehind: !0,
        inside: Prism.languages.javascript
    }],
    constant: /\b[A-Z](?:[A-Z_]|\dx?)*\b/
}), Prism.languages.insertBefore("javascript", "string", {
    hashbang: {
        pattern: /^#!.*/,
        greedy: !0,
        alias: "comment"
    },
    "template-string": {
        pattern: /`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,
        greedy: !0,
        inside: {
            "template-punctuation": {
                pattern: /^`|`$/,
                alias: "string"
            },
            interpolation: {
                pattern: /((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,
                lookbehind: !0,
                inside: {
                    "interpolation-punctuation": {
                        pattern: /^\$\{|\}$/,
                        alias: "punctuation"
                    },
                    rest: Prism.languages.javascript
                }
            },
            string: /[\s\S]+/
        }
    },
    "string-property": {
        pattern: /((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,
        lookbehind: !0,
        greedy: !0,
        alias: "property"
    }
}), Prism.languages.insertBefore("javascript", "operator", {
    "literal-property": {
        pattern: /((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,
        lookbehind: !0,
        alias: "property"
    }
}), Prism.languages.markup && (Prism.languages.markup.tag.addInlined("script", "javascript"), Prism.languages.markup.tag.addAttribute("on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)", "javascript")), Prism.languages.js = Prism.languages.javascript;
Prism.languages.python = {
    comment: {
        pattern: /(^|[^\\])#.*/,
        lookbehind: !0,
        greedy: !0
    },
    "string-interpolation": {
        pattern: /(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,
        greedy: !0,
        inside: {
            interpolation: {
                pattern: /((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,
                lookbehind: !0,
                inside: {
                    "format-spec": {
                        pattern: /(:)[^:(){}]+(?=\}$)/,
                        lookbehind: !0
                    },
                    "conversion-option": {
                        pattern: /![sra](?=[:}]$)/,
                        alias: "punctuation"
                    },
                    rest: null
                }
            },
            string: /[\s\S]+/
        }
    },
    "triple-quoted-string": {
        pattern: /(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,
        greedy: !0,
        alias: "string"
    },
    string: {
        pattern: /(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,
        greedy: !0
    },
    function: {
        pattern: /((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,
        lookbehind: !0
    },
    "class-name": {
        pattern: /(\bclass\s+)\w+/i,
        lookbehind: !0
    },
    decorator: {
        pattern: /(^[\t ]*)@\w+(?:\.\w+)*/m,
        lookbehind: !0,
        alias: ["annotation", "punctuation"],
        inside: {
            punctuation: /\./
        }
    },
    keyword: /\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,
    builtin: /\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,
    boolean: /\b(?:False|None|True)\b/,
    number: /\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,
    operator: /[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,
    punctuation: /[{}[\];(),.:]/
}, Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest = Prism.languages.python, Prism.languages.py = Prism.languages.python;
! function () {
    if ("undefined" != typeof Prism) {
        var e = Object.assign || function (e, t) {
            for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]);
            return e
        },
            t = {
                "remove-trailing": "boolean",
                "remove-indent": "boolean",
                "left-trim": "boolean",
                "right-trim": "boolean",
                "break-lines": "number",
                indent: "number",
                "remove-initial-line-feed": "boolean",
                "tabs-to-spaces": "number",
                "spaces-to-tabs": "number"
            };
        n.prototype = {
            setDefaults: function (t) {
                this.defaults = e(this.defaults, t)
            },
            normalize: function (t, n) {
                for (var r in n = e(this.defaults, n)) {
                    var i = r.replace(/-(\w)/g, (function (e, t) {
                        return t.toUpperCase()
                    }));
                    "normalize" !== r && "setDefaults" !== i && n[r] && this[i] && (t = this[i].call(this, t, n[r]))
                }
                return t
            },
            leftTrim: function (e) {
                return e.replace(/^\s+/, "")
            },
            rightTrim: function (e) {
                return e.replace(/\s+$/, "")
            },
            tabsToSpaces: function (e, t) {
                return t = 0 | t || 4, e.replace(/\t/g, new Array(++t).join(" "))
            },
            spacesToTabs: function (e, t) {
                return t = 0 | t || 4, e.replace(RegExp(" {" + t + "}", "g"), "\t")
            },
            removeTrailing: function (e) {
                return e.replace(/\s*?$/gm, "")
            },
            removeInitialLineFeed: function (e) {
                return e.replace(/^(?:\r?\n|\r)/, "")
            },
            removeIndent: function (e) {
                var t = e.match(/^[^\S\n\r]*(?=\S)/gm);
                return t && t[0].length ? (t.sort((function (e, t) {
                    return e.length - t.length
                })), t[0].length ? e.replace(RegExp("^" + t[0], "gm"), "") : e) : e
            },
            indent: function (e, t) {
                return e.replace(/^[^\S\n\r]*(?=\S)/gm, new Array(++t).join("\t") + "$&")
            },
            breakLines: function (e, t) {
                t = !0 === t ? 80 : 0 | t || 80;
                for (var n = e.split("\n"), i = 0; i < n.length; ++i)
                    if (!(r(n[i]) <= t)) {
                        for (var o = n[i].split(/(\s+)/g), a = 0, l = 0; l < o.length; ++l) {
                            var s = r(o[l]);
                            (a += s) > t && (o[l] = "\n" + o[l], a = s)
                        }
                        n[i] = o.join("")
                    } return n.join("\n")
            }
        }, "undefined" != typeof module && module.exports && (module.exports = n), Prism.plugins.NormalizeWhitespace = new n({
            "remove-trailing": !0,
            "remove-indent": !0,
            "left-trim": !0,
            "right-trim": !0
        }), Prism.hooks.add("before-sanity-check", (function (e) {
            var n = Prism.plugins.NormalizeWhitespace;
            if ((!e.settings || !1 !== e.settings["whitespace-normalization"]) && Prism.util.isActive(e.element, "whitespace-normalization", !0))
                if (e.element && e.element.parentNode || !e.code) {
                    var r = e.element.parentNode;
                    if (e.code && r && "pre" === r.nodeName.toLowerCase()) {
                        for (var i in null == e.settings && (e.settings = {}), t)
                            if (Object.hasOwnProperty.call(t, i)) {
                                var o = t[i];
                                if (r.hasAttribute("data-" + i)) try {
                                    var a = JSON.parse(r.getAttribute("data-" + i) || "true");
                                    typeof a === o && (e.settings[i] = a)
                                } catch (e) { }
                            } for (var l = r.childNodes, s = "", c = "", u = !1, m = 0; m < l.length; ++m) {
                                var f = l[m];
                                f == e.element ? u = !0 : "#text" === f.nodeName && (u ? c += f.nodeValue : s += f.nodeValue, r.removeChild(f), --m)
                            }
                        if (e.element.children.length && Prism.plugins.KeepMarkup) {
                            var d = s + e.element.innerHTML + c;
                            e.element.innerHTML = n.normalize(d, e.settings), e.code = e.element.textContent
                        } else e.code = s + e.code + c, e.code = n.normalize(e.code, e.settings)
                    }
                } else e.code = n.normalize(e.code, e.settings)
        }))
    }

    function n(t) {
        this.defaults = e({}, t)
    }

    function r(e) {
        for (var t = 0, n = 0; n < e.length; ++n) e.charCodeAt(n) == "\t".charCodeAt(0) && (t += 3);
        return e.length + t
    }
}();

window.addEventListener("mousedown", (e) => {
    bbcodemousedown = e;
})
